---
layout: post
title: Retrieving the Icon Image within the System Image List in .NETCF 2.0
date: '2007-06-12T19:07:00.001+02:00'
author: Christian Resma Helle
tags:
- Windows Mobile
- ".NET Compact Framework"
modified_time: '2007-06-14T20:39:39.543+02:00'
blogger_id: tag:blogger.com,1999:blog-4995334164049002857.post-9075719262103873058
blogger_orig_url: https://christian-helle.blogspot.com/2007/06/retrieving-icon-image-within-system_295.html
---

Here's a nice trick for retrieving the icon image of a file or folder from the system image list. All we actually need is to P/Invoke <font face="Courier">SHGetFileInfo</font> and use <font face="Courier">Icon.FromHandle()</font> to get the Icon.<br /><br />First, we need to declare our P/Invokes.<br /><font face="Courier"><br />[<font color="#408080">StructLayout</font>(<font color="#408080">LayoutKind</font>.Sequential)]<br /><font color="Blue">struct</font> <font color="#408080">SHFILEINFO</font><br />{<br />&nbsp;&nbsp;<font color="Blue">public IntPtr</font> hIcon;<br />&nbsp;&nbsp;<font color="Blue">public IntPtr</font> iIcon;<br />&nbsp;&nbsp;<font color="Blue">public uint</font> dwAttributes;<br />&nbsp;&nbsp;[<font color="#408080">MarshalAs</font>(<font color="#408080">UnmanagedType</font>.ByValTStr, SizeConst = 260)]<br />&nbsp;&nbsp;<font color="Blue">public string</font> szDisplayName;<br />&nbsp;&nbsp;[<font color="#408080">MarshalAs</font>(<font color="#408080">UnmanagedType</font>.ByValTStr, SizeConst = 80)]<br />&nbsp;&nbsp;<font color="Blue">public string</font> szTypeName;<br />}<br /><br /><font color="Blue">const uint</font> SHGFI_ICON = 0x000000100;<br /><font color="Blue">const uint</font> SHGFI_LARGEICON = 0x000000000;<br /><font color="Blue">const uint</font> SHGFI_SMALLICON = 0x000000001;<br /><font color="Blue">const uint</font> SHGFI_SELECTICON = 0x000040000;<br /><br />[<font color="#408080">DllImport</font>(<font color="Red">"coredll.dll"</font>)]<br /><font color="Blue">static extern</font> <font color="#408080">IntPtr</font> SHGetFileInfo(<font color="Blue">string</font> pszPath, <font color="Blue">uint</font> dwFileAttributes, <br />&nbsp;&nbsp;<font color="Blue">ref</font> <font color="#408080">SHFILEINFO</font> psfi, <font color="Blue">uint</font> cbSizeFileInfo, <font color="Blue">uint</font> uFlags);<br /></font><br /><br />To get an instance of <font face="Courier">System.Drawing.Icon</font> for the small icon of a file<br /><font face="Courier"><br /><font color="#408080">Icon</font> GetSystemIconSmall(<font color="Blue">string</font> file)<br />{<br />&nbsp;&nbsp;<font color="#408080">SHFILEINFO</font> shinfo = <font color="Blue">new</font> <font color="#408080">SHFILEINFO</font>();<br />&nbsp;&nbsp;<font color="#408080">IntPtr</font> i = SHGetFileInfo(file, 0, <font color="Blue">ref</font> shinfo,<br />&nbsp;&nbsp;&nbsp;&nbsp;(<font color="Blue">uint</font>)<font color="#408080">Marshal</font>.SizeOf(shinfo), SHGFI_ICON | SHGFI_SMALLICON);<br /><br />&nbsp;&nbsp;<font color="Blue">return</font> <font color="#408080">Icon</font>.FromHandle(shinfo.hIcon);<br />}<br /></font><br /><br />For the large icon of a file<br /><font face="Courier"><br /><font color="#408080">Icon</font> GetSystemIconLarge(<font color="Blue">string</font> file)<br />{<br />&nbsp;&nbsp;<font color="#408080">SHFILEINFO</font> shinfo = <font color="Blue">new</font> <font color="#408080">SHFILEINFO</font>();<br />&nbsp;&nbsp;<font color="#408080">IntPtr</font> i = SHGetFileInfo(file, 0, <font color="Blue">ref</font> shinfo,<br />&nbsp;&nbsp;&nbsp;&nbsp;(<font color="Blue">uint</font>)<font color="#408080">Marshal</font>.SizeOf(shinfo), SHGFI_ICON | SHGFI_LARGEICON);<br /><br />&nbsp;&nbsp;<font color="Blue">return</font> <font color="#408080">Icon</font>.FromHandle(shinfo.hIcon);<br />}<br /></font><br /><br />For the small icon of a file when it is selected<br /><font face="Courier"><br /><font color="#408080">Icon</font> GetSystemIconSmallSelected(<font color="Blue">string</font> file)<br />{<br />&nbsp;&nbsp;<font color="#408080">SHFILEINFO</font> shinfo = <font color="Blue">new</font> <font color="#408080">SHFILEINFO</font>();<br />&nbsp;&nbsp;<font color="#408080">IntPtr</font> i = SHGetFileInfo(file, 0, <font color="Blue">ref</font> shinfo,<br />&nbsp;&nbsp;&nbsp;&nbsp;(<font color="Blue">uint</font>)<font color="#408080">Marshal</font>.SizeOf(shinfo), SHGFI_ICON | SHGFI_SMALLICON | SHGFI_SELECTICON);<br /><br />&nbsp;&nbsp;<font color="Blue">return</font> <font color="#408080">Icon</font>.FromHandle(shinfo.hIcon);<br />}<br /></font><br /><br />And last for the large icon of a file when it is selected<br /><font face="Courier"><br /><font color="#408080">Icon</font> GetSystemIconLargeSelected(<font color="Blue">string</font> file)<br />{<br />&nbsp;&nbsp;<font color="#408080">SHFILEINFO</font> shinfo = <font color="Blue">new</font> <font color="#408080">SHFILEINFO</font>();<br />&nbsp;&nbsp;<font color="#408080">IntPtr</font> i = SHGetFileInfo(file, 0, <font color="Blue">ref</font> shinfo,<br />&nbsp;&nbsp;&nbsp;&nbsp;(<font color="Blue">uint</font>)<font color="#408080">Marshal</font>.SizeOf(shinfo), SHGFI_ICON | SHGFI_LARGEICON | SHGFI_SELECTICON);<br /><br />&nbsp;&nbsp;<font color="Blue">return</font> <font color="#408080">Icon</font>.FromHandle(shinfo.hIcon);<br />}<br /></font><br />Ok, now how is this helpful? Well if you want to implement a File Explorer-ish control, then wouldn't have to include Icons and other images in your application. You can just use the icons in the system image list