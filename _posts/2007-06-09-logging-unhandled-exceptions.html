---
layout: post
title: Logging Unhandled Exceptions
date: '2007-06-09T16:06:00.001+02:00'
# author: Christian Resma Helle
tags:
- Windows Mobile
- ".NET Compact Framework"
modified_time: '2007-06-11T09:51:09.749+02:00'
blogger_id: tag:blogger.com,1999:blog-4995334164049002857.post-1410492378440252064
blogger_orig_url: https://christian-helle.blogspot.com/2007/06/logging-unhandled-exceptions.html
---

Bugs are sometimes unavoidable. They're best caught during the development or testing phase. There might be some cases where the developer forgot to handle possible exceptions in a function. It could be possible that this exception isn't handled anywhere at all. But even so, it is still possible to catch this exception. To do this we handle the <font face="Courier">UnhandledException</font> event of the current AppDomain. We should do this in our <font face="Courier">static void Main()</font> before calling <font face="Courier">Application.Run([Main Form])</font><br /><br />Here's a small snippet to accomplish this task.<br /><br />[C# CODE]<br /><font face="Courier" size=2><br /><font color="Blue">static void</font> Main()<br />{<br />&nbsp;&nbsp;<font color="#408080">AppDomain</font>.CurrentDomain.UnhandledException += <br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="Blue">new</font> <font color="#408080">UnhandledExceptionEventHandler</font>(CurrentDomain_UnhandledException);<br />&nbsp;&nbsp;<font color="#408080">Application</font>.Run(new <font color="#408080">MainForm</font>());<br />}<br /><br /><font color="Blue">static void</font> CurrentDomain_UnhandledException(<font color="Blue">object</font> sender, <font color="#408080">UnhandledExceptionEventArgs</font> e)<br />{<br />&nbsp;&nbsp;<font color="#408080">Exception</font> exception = (<font color="#408080">Exception</font>)e.ExceptionObject;<br />&nbsp;&nbsp;<font color="Blue">if</font> (exception != <font color="Blue">null</font>) {<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#408080">Error</font>.Append(exception.Message, exception.StackTrace);<br />&nbsp;&nbsp;}<br />}<br /></font><br />Now we need a mechanism for saving to a Error log file. Let's create a simple class called <font face="Courier">Error()</font> and add a function called <font face="Courier">Append(string message, string stacktrace)</font><br /><br />[C# CODE]<br /><font face="Courier" size=2><br /><font color="Blue">public class</font> <font color="#408080">Error</font><br />{<br />&nbsp;&nbsp;<font color="Blue">internal static void</font> Append(<font color="Blue">string</font> message, <font color="Blue">string</font> stacktrace)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="Blue">string</font> file = <font color="Blue">string</font>.Format(<font color="Red">"{0}\\Errors.txt"</font>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#408080">Path</font>.GetDirectoryName(<font color="#408080">Assembly</font>.GetExecutingAssembly().GetName().CodeBase));<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="Blue">if</font> (<font color="#408080">File</font>.Exists(file)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#408080">FileInfo</font> fi = <font color="Blue">new</font> <font color="#408080">FileInfo</font>(file);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="Blue">if</font> (fi.Length > 100 * 1024) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fi.Delete();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#408080">StreamWriter</font> sw = <font color="Blue">new</font> <font color="#408080">StreamWriter</font>(file, <font color="Blue">true</font>, <font color="#408080">Encoding</font>.UTF8);<br />&nbsp;&nbsp;&nbsp;&nbsp;sw.WriteLine(<font color="Blue">string</font>.Format(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="Red">"-=-=-=-=-=--=-=-\n{0}\nMESSAGE:\n{1}\nSTACK TRACE:\n{3}\n"</font>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#408080">DateTime</font>.Now, message, stacktrace));<br />&nbsp;&nbsp;&nbsp;&nbsp;sw.Close();<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;}<br />}<br /></font><br />The <font face="Courier">Error()</font> class should be put in a namespace that is accessible throughout the application. This will be very helpful tool for finding those nasty almost impossible to reproduce bugs.