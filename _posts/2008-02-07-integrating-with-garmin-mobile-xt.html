---
layout: post
title: Integrating with Garmin Mobile XT
date: '2008-02-07T22:15:00.119+01:00'
author: Christian Resma Helle
tags:
- GPS
- Windows Mobile
- ".NET Compact Framework"
modified_time: '2008-02-17T15:10:18.324+01:00'
blogger_id: tag:blogger.com,1999:blog-4995334164049002857.post-4809292998115058207
blogger_orig_url: https://christian-helle.blogspot.com/2008/02/integrating-with-garmin-mobile-xt.html
---

Half a year ago, I wrote an article about <a href="/2007/06/integrating-with-tomtom-navigator.html">Integrating with TomTom Navigator</a>. This time I'm gonna discuss how you can integrate a .NET Compact Framework application with the Garmin Mobile XT navigation software. The process is a bit similar to integrating with TomTom because the Garmin SDK only provides a native API.<br /><br />Before we get started, we need to have the <a href="http://developer.garmin.com/mobile/mobile-sdk/xt-wm-sdk/">Garmin Mobile XT for the Windows Mobile platform</a>. Unlike TomTom's SDK, Garmin's SDK is available free of charge for download.<br /><br />Before we can get more into detail, we will need the following:<br />1) Visual Studio 2005 or 2008<br />2) Windows Mobile 5.0 SDK for Pocket PC<br />3) A windows mobile device a GPS receiver and the Garmin Mobile XT (and Maps)<br />4) Garmin Mobile XT SDK for the Windows Mobile platform<br /><br />We will be making the same projects we made for <a href="/2007/06/integrating-with-tomtom-navigator.html">Integrating with TomTom Navigator</a>:<br />1) Native wrapper for the Garmin XT SDK<br />2) Managed Garmin XT SDK wrapper<br />3) Device application that will call the Garmin XT SDK wrapper methods<br /><br /><br />Let's get started...<br /><br /><br /><b>Native wrapper for the Garmin XT SDK</b><br /><br />The Garmin SDK ships with C++ header files and a static library that a native application can link to. For that reason we need to create a native DLL that exposes the methods that we need as C type funtions. Let's call this <b>Garmin.Native.dll</b>.<br /><br />In this article, we will implement a managed call to the Garmin Mobile XT to allow us to launch the Garmin Mobile XT, Navigate to a specific address or GPS coordinate, and to Show an address on the Map. These tasks will be performed on a native wrapper and which will be called from managed code.<br /><br />We will be using the following methods from the Garmin Mobile XT SDK:<br />- QueLaunchApp<br />- QueAPIOpen<br />- QueAPIClose<br />- QueCreatePointFromAddress<br />- QueCreatePoint<br />- QueRouteToPoint<br />- QueViewPointOnMap<br /><br />These methods return specific error codes describing whether the command executed successfully or not. This error information is translated to a .NET Framework enum which we will see later.<br /><br /><font face="courier"><br /><font color="blue">#include</font> <font color="red">"QueAPI.h"</font><br /><br /><font color="blue">#define</font> EXPORTC <font color="blue">extern</font> <font color="red">"C"</font> <font color="blue">__declspec</font>(<font color="blue">dllexport</font>)<br /><br /><font color="blue">long</font> DecimalDegreesToSemicircles(<font color="blue">double</font> degrees);<br /><br />BOOL APIENTRY DllMain(<br />&nbsp;&nbsp;HANDLE hModule, <br />&nbsp;&nbsp;DWORD ul_reason_for_call, <br />&nbsp;&nbsp;LPVOID lpReserved)<br />{<br />&nbsp;&nbsp;<font color="blue">switch</font> (ul_reason_for_call)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">case</font> DLL_PROCESS_ATTACH:<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">case</font> DLL_THREAD_ATTACH:<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">case</font> DLL_THREAD_DETACH:<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">case</font> DLL_PROCESS_DETACH:<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">break</font>;<br />&nbsp;&nbsp;}<br />&nbsp;&nbsp;<font color="blue">return</font> TRUE;<br />}<br /><br /><font color="blue">static void</font> QueCallback(QueNotificationT8 aNotification)<br />{<br />&nbsp;&nbsp;<font color="green">// Used for debugging purposes</font><br />}<br /><br />EXPORTC <font color="blue">int</font> CloseAPI()<br />{<br />&nbsp;&nbsp;QueErrT16 err = QueAPIClose(QueCallback);<br />&nbsp;&nbsp;<font color="blue">return</font> err;<br />}<br /><br />EXPORTC <font color="blue">int</font> OpenNavigator()<br />{<br />&nbsp;&nbsp;QueErrT16 err = QueLaunchApp(queAppMap);<br />&nbsp;&nbsp;<font color="blue">return</font> err;<br />}<br /><br />EXPORTC <font color="blue">int</font> NavigateToAddress(<br />&nbsp;&nbsp;<font color="blue">const wchar_t</font> *streetAddress,<br />&nbsp;&nbsp;<font color="blue">const wchar_t</font> *city,<br />&nbsp;&nbsp;<font color="blue">const wchar_t</font> *postalCode,<br />&nbsp;&nbsp;<font color="blue">const wchar_t</font> *state,<br />&nbsp;&nbsp;<font color="blue">const wchar_t</font> *country)<br />{<br />&nbsp;&nbsp;QueErrT16 err = QueAPIOpen(QueCallback);<br />&nbsp;&nbsp;<font color="blue">if</font> (err != gpsErrNone) {<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">return</font> err;<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;QueSelectAddressType address;<br />&nbsp;&nbsp;QuePointHandle point = queInvalidPointHandle;<br /><br />&nbsp;&nbsp;memset(&amp;address, 0, <font color="blue">sizeof</font>(QueSelectAddressType));<br />&nbsp;&nbsp;address.streetAddress = streetAddress;<br />&nbsp;&nbsp;address.city = city;<br />&nbsp;&nbsp;address.postalCode = postalCode;<br />&nbsp;&nbsp;address.state = state;<br />&nbsp;&nbsp;address.country = country;<br /><br />&nbsp;&nbsp;err = QueCreatePointFromAddress(&amp;address, &amp;point);<br />&nbsp;&nbsp;<font color="blue">if</font> (err == queErrNone &amp;&amp; point != queInvalidPointHandle) {<br />&nbsp;&nbsp;&nbsp;&nbsp;err = QueRouteToPoint(point);<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;QueAPIClose(QueCallback);<br />&nbsp;&nbsp;<font color="blue">return</font> err;<br />}<br /><br /><font color="blue">long</font> DecimalDegreesToSemicircles(<font color="blue">double</font> degrees)<br />{<br />&nbsp;&nbsp;<font color="blue">return</font> degrees * (0x80000000 / 180);<br />}<br /><br />EXPORTC <font color="blue">int</font> NavigateToCoordinates(<font color="blue">double</font> latitude, <font color="blue">double</font> longitude)<br />{<br />&nbsp;&nbsp;QueErrT16 err = QueAPIOpen(QueCallback);<br />&nbsp;&nbsp;<font color="blue">if</font> (err != gpsErrNone) {<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">return</font> err;<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;QuePointType point;<br />&nbsp;&nbsp;QuePositionDataType position;<br /><br />&nbsp;&nbsp;memset(&amp;position, 0, <font color="blue">sizeof</font>(QuePositionDataType));<br />&nbsp;&nbsp;position.lat = DecimalDegreesToSemicircles(latitude);<br />&nbsp;&nbsp;position.lon = DecimalDegreesToSemicircles(longitude);<br /><br />&nbsp;&nbsp;memset(&amp;point, 0, <font color="blue">sizeof</font>(QuePointType));<br />&nbsp;&nbsp;point.posn = position;<br /><br />&nbsp;&nbsp;QuePointHandle hPoint;<br />&nbsp;&nbsp;memset(&amp;hPoint, 0, <font color="blue">sizeof</font>(QuePointHandle));<br /><br />&nbsp;&nbsp;err = QueCreatePoint(&amp;point, &amp;hPoint);<br />&nbsp;&nbsp;<font color="blue">if</font> (err == queErrNone &amp;&amp; hPoint != queInvalidPointHandle) {<br />&nbsp;&nbsp;&nbsp;&nbsp;err = QueRouteToPoint(hPoint);<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;QueAPIClose(QueCallback);<br />&nbsp;&nbsp;<font color="blue">return</font> err;<br />}<br /><br />EXPORTC <font color="blue">int</font> ShowAddressOnMap(<br />&nbsp;&nbsp;<font color="blue">const wchar_t</font> *streetAddress,<br />&nbsp;&nbsp;<font color="blue">const wchar_t</font> *city,<br />&nbsp;&nbsp;<font color="blue">const wchar_t</font> *postalCode,<br />&nbsp;&nbsp;<font color="blue">const wchar_t</font> *state,<br />&nbsp;&nbsp;<font color="blue">const wchar_t</font> *country)<br />{<br />&nbsp;&nbsp;QueErrT16 err = QueAPIOpen(QueCallback);<br />&nbsp;&nbsp;<font color="blue">if</font> (err != gpsErrNone) {<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">return</font> err;<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;QueSelectAddressType address;<br />&nbsp;&nbsp;QuePointHandle point = queInvalidPointHandle;<br /><br />&nbsp;&nbsp;memset(&amp;address, 0, <font color="blue">sizeof</font>(QueSelectAddressType));<br />&nbsp;&nbsp;address.streetAddress = streetAddress;<br />&nbsp;&nbsp;address.city = city;<br />&nbsp;&nbsp;address.postalCode = postalCode;<br />&nbsp;&nbsp;address.state = state;<br />&nbsp;&nbsp;address.country = country;<br /><br />&nbsp;&nbsp;err = QueCreatePointFromAddress(&amp;address, &amp;point);<br />&nbsp;&nbsp;<font color="blue">if</font> (err == queErrNone &amp;&amp; point != queInvalidPointHandle) {<br />&nbsp;&nbsp;&nbsp;&nbsp;err = QueViewPointOnMap(point);<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;QueAPIClose(QueCallback);<br />&nbsp;&nbsp;<font color="blue">return</font> err;<br />}<br /></font><br />The Garmin Mobile XT SDK works in a straight forward way. Before making any calls to the API, you first need to Open it. Once open, you can start executing a series of methods and then once you're done you must Close the API. The Garmin Mobile XT has to be running before you can execute commands to it, otherwise you will get a communication error.<br /><br />You might notice in the code above an empty static method called QueCallback(QueNotificationT8 aNotification). This is a callback method that receives the information about the application state. You can use this for making callbacks from native to managed code. You can pass a delegate method from managed code to the native methods that expect QueNotificationCallback as a parameter. We will only use it for debugging purposes in this example. We will not dig more into that in this article.<br /><br />Normally when reverse geocoding an address to a GPS coordinates using some free service, you will get the coordinates in decimal degrees (WGS84 decimal format). Navigating to a coordinate using the Garmin Mobile XT SDK requires the coordinates to be in semicircles (2^31 semicircles equals 180 degrees).<br /><br />To convert decimal degrees to semicircles we use the following formula:<br /><i>semicircles = decimal degrees * (2^31 / 180)</i><br /><br /><br /><b>Managed wrapper</b><br /><br />In my article <a href="/2007/06/integrating-with-tomtom-navigator.html">Integrating with TomTom Navigator</a>, I created a Generic Navigator wrapper that uses the INavigator interface for defining methods to be used by the managed wrapper. The purpose of the Generic Navigator was to allow the application to integrate with several navigation solutions without changing any of the existing code. As I already discussed this in the past, I will skip this part and only focus on how to integrate with Garmin Mobile XT.<br /><br />We first need to create an enumeration containing error codes we receive from the native wrapper.<br /><font face="courier"><br /><font color="blue">public enum</font> <font color="#408080">GarminErrorCodes</font> : <font color="blue">int</font><br />{<br />&nbsp;&nbsp;None = 0,<br />&nbsp;&nbsp;NotOpen = 1,<br />&nbsp;&nbsp;InvalidParameter,<br />&nbsp;&nbsp;OutOfMemory,<br />&nbsp;&nbsp;NoData,<br />&nbsp;&nbsp;AlreadyOpen,<br />&nbsp;&nbsp;InvalidVersion,<br />&nbsp;&nbsp;CommunicationError,<br />&nbsp;&nbsp;CmndUnavailable,<br />&nbsp;&nbsp;LibraryStillOpen,<br />&nbsp;&nbsp;GeneralFailure,<br />&nbsp;&nbsp;Cancelled,<br />&nbsp;&nbsp;RelaunchNeeded<br />}<br /></font><br />We of course need to create our P/Invoke declarations. This time let's put them in an internal class called NativeMethods()<br /><font face="courier"><br /><font color="blue">internal class</font> <font color="#408080">NativeMethods</font><br />{<br />&nbsp;&nbsp;[<font color="#408080">DllImport</font>(<font color="red">"Garmin.Native.dll"</font>)]<br />&nbsp;&nbsp;<font color="blue">internal static extern int</font> CloseAPI();<br /><br />&nbsp;&nbsp;[<font color="#408080">DllImport</font>(<font color="red">"Garmin.Native.dll"</font>)]<br />&nbsp;&nbsp;<font color="blue">internal static extern int</font> OpenNavigator();<br /><br />&nbsp;&nbsp;[<font color="#408080">DllImport</font>(<font color="red">"Garmin.Native.dll"</font>)]<br />&nbsp;&nbsp;<font color="blue">internal static extern int</font> NavigateToAddress(<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">string</font> address,<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">string</font> city,<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">string</font> postalcode,<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">string</font> state,<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">string</font> country);<br /><br />&nbsp;&nbsp;[<font color="#408080">DllImport</font>(<font color="red">"Garmin.Native.dll"</font>)]<br />&nbsp;&nbsp;<font color="blue">internal static extern int</font> NavigateToCoordinates(<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">double</font> latitude,<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">double</font> longitude);<br /><br />&nbsp;&nbsp;[<font color="#408080">DllImport</font>(<font color="red">"Garmin.Native.dll"</font>)]<br />&nbsp;&nbsp;<font color="blue">internal static extern int</font> ShowAddressOnMap(<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">string</font> address,<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">string</font> city,<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">string</font> postalcode,<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">string</font> state,<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">string</font> country);<br />}<br /></font><br />Let's create a .NET exception that we can throw which contains native error details when a native method call fails. Let's call it GarminNativeException()<br /><font face="courier"><br />[<font color="#408080">Serializable</font>]<br /><font color="blue">public class</font> <font color="#408080">GarminNativeException</font> : <font color="#408080">Exception</font><br />{<br />&nbsp;&nbsp;<font color="blue">public</font> GarminNativeException() { }<br /><br />&nbsp;&nbsp;<font color="blue">public</font> GarminNativeException(<font color="#408080">GarminErrorCodes</font> native_error) { }<br /><br />&nbsp;&nbsp;<font color="blue">public</font> GarminNativeException(<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">string</font> message,<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#408080">GarminErrorCodes</font> native_error) : <font color="blue">base</font>(message) { }<br />}<br /></font><br />Now we need a class that we can use for calling the wrapped managed methods to the Garmin mobile XT. Let's call it GarminXT()<br /><font face="courier"><br /><font color="blue">public class</font> <font color="#408080">GarminXT</font> : <font color="#408080">IDisposable</font><br />{<br />&nbsp;&nbsp;<font color="blue">public void</font> Dispose()<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#408080">NativeMethods</font>.CloseAPI();<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">public void</font> OpenNavigator()<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#408080">GarminErrorCodes</font> err = (<font color="#408080">GarminErrorCodes</font>)<font color="#408080">NativeMethods</font>.OpenNavigator();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if</font> (err != <font color="#408080">GarminErrorCodes</font>.None) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ThrowGarminException(err);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">public void</font> NavigateToAddress(<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">string</font> address,<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">string</font> city,<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">string</font> postalcode,<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">string</font> state,<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">string</font> country)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#408080">GarminErrorCodes</font> err = (<font color="#408080">GarminErrorCodes</font>)<font color="#408080">NativeMethods</font>.NavigateToAddress(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;address,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;city,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;postalcode,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;state,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;country);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if</font> (err != <font color="#408080">GarminErrorCodes</font>.None) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ThrowGarminException(err);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">public void</font> NavigateToCoordinates(<font color="blue">double</font> latitude, <font color="blue">double</font> longitude)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#408080">GarminErrorCodes</font> err = (<font color="#408080">GarminErrorCodes</font>)<font color="#408080">NativeMethods</font>.NavigateToCoordinates(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;latitude,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;longitude);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if</font> (err != <font color="#408080">GarminErrorCodes</font>.None) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ThrowGarminException(err);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">public void</font> ShowAddressOnMap(<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">string</font> address,<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">string</font> city,<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">string</font> postalcode,<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">string</font> state,<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">string</font> country)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#408080">GarminErrorCodes</font> err = (<font color="#408080">GarminErrorCodes</font>)<font color="#408080">NativeMethods</font>.ShowAddressOnMap(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;address,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;city,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;postalcode,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;state,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;country);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if</font> (err != <font color="#408080">GarminErrorCodes</font>.None) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ThrowGarminException(err);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">private</font> <font color="#408080">GarminNativeException</font> ThrowGarminException(<font color="#408080">GarminErrorCodes</font> err)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">string</font> message = <font color="blue">string</font>.Empty;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">switch</font> (err) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">case</font> <font color="#408080">GarminErrorCodes</font>.NotOpen:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message = <font color="red">"Close() called without having Open() first"</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">break</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">case</font> <font color="#408080">GarminErrorCodes</font>.InvalidParameter:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message = <font color="red">"Invalid parameter was passed to the function"</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">break</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">case</font> <font color="#408080">GarminErrorCodes</font>.OutOfMemory:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message = <font color="red">"Out of Memory"</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">break</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">case</font> <font color="#408080">GarminErrorCodes</font>.NoData:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message = <font color="red">"No Data Available"</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">break</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">case</font> <font color="#408080">GarminErrorCodes</font>.AlreadyOpen:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message = <font color="red">"The API is already open"</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">break</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">case</font> <font color="#408080">GarminErrorCodes</font>.InvalidVersion:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message = <font color="red">"The API is an incompatible version"</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">break</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">case</font> <font color="#408080">GarminErrorCodes</font>.CommunicationError:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message = <font color="red">"There was an error communicating with the API"</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">break</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">case</font> <font color="#408080">GarminErrorCodes</font>.CmndUnavailable:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message = <font color="red">"Command is unavailable"</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">break</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">case</font> <font color="#408080">GarminErrorCodes</font>.LibraryStillOpen:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message = <font color="red">"API is still open"</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">break</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">case</font> <font color="#408080">GarminErrorCodes</font>.GeneralFailure:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message = <font color="red">"General Failure"</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">break</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">case</font> <font color="#408080">GarminErrorCodes</font>.Cancelled:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message = <font color="red">"Action was cancelled by the user"</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">break</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">case</font> <font color="#408080">GarminErrorCodes</font>.RelaunchNeeded:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message = <font color="red">"Relaunch needed to load the libraries"</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">break</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">default</font>:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">break</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">throw new</font> GarminNativeException(message, err);<br />&nbsp;&nbsp;}<br />}<br /></font><br />The managed wrapper GarminXT() implements IDisposible for ensuring that the API will be closed when the GarminXT object gets disposed. I check the return code of every method to verify if the native method call succeeded or failed. If the native method call failed then I throw a GarminNativeException containing a text description of the error and the GarminErrorCode returned by the native method call.<br /><br /><br /><b>Using the Managed Wrapper</b><br /><br />Now that we have a managed wrapper for the Garmin Mobile XT SDK we can start testing it with a simple smart device application. Let's say that we created a simple application that accepts street address, city, postal code, country, latitude, longitude. We also have some buttons or menu items for: Navigating to an address, Navigating to coordinates, Showing an address on the map, and for launching Garmin Mobile XT.<br /><br />Since the managed wrapper implements IDisposable, we surround our calls to it with the <font face="courier">using</font> statement:<br /><font face="courier"><br /><font color="blue">using</font> (<font color="#408080">GarminXT</font> xt = <font color="blue">new</font> <font color="#408080">GarminXT</font>()) {<br />&nbsp;&nbsp;xt.OpenNavigator();<br />}<br /></font><br />As I mentioned before, it is important that Garmin Mobile XT is running in the background for executing certain commands. Otherwise the managed Garmin XT wrapper will throw a GarminNativeException saying that there was an error communicating with the API. I would suggest handling the GarminNativeException everytime calls to the managed wrapper are made.<br /><br />For launching Garmin Mobile XT:<br /><font face="courier"><br /><font color="blue">try</font> {<br />&nbsp;&nbsp;<font color="blue">using</font> (<font color="#408080">GarminXT</font> xt = <font color="blue">new</font> <font color="#408080">GarminXT</font>()) {<br />&nbsp;&nbsp;&nbsp;&nbsp;xt.OpenNavigator();<br />&nbsp;&nbsp;}<br />}<br /><font color="blue">catch</font> (<font color="#408080">GarminNativeException</font> ex) {<br />&nbsp;&nbsp;<font color="#408080">Debug</font>.Assert(<font color="blue">false</font>, ex.Message, ex.StackTrace);<br />}<br /></font><br />For navigating to an address:<br /><font face="courier"><br /><font color="blue">try</font> {<br />&nbsp;&nbsp;<font color="blue">using</font> (<font color="#408080">GarminXT</font> xt = <font color="blue">new</font> <font color="#408080">GarminXT</font>()) {<br />&nbsp;&nbsp;&nbsp;&nbsp;xt.NavigateToAddress(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="red">"Hørkær 24"</font>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="red">"Herlev"</font>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="red">"2730"</font>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">null</font>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="red">"Denmark"</font>);<br />&nbsp;&nbsp;}<br />}<br /><font color="blue">catch</font> (<font color="#408080">GarminNativeException</font> ex) {<br />&nbsp;&nbsp;<font color="#408080">Debug</font>.Assert(<font color="blue">false</font>, ex.Message, ex.StackTrace);<br />}<br /></font><br />For navigating to coordinates:<br /><font face="courier"><br /><font color="blue">try</font> {<br />&nbsp;&nbsp;<font color="blue">using</font> (<font color="#408080">GarminXT</font> xt = <font color="blue">new</font> <font color="#408080">GarminXT</font>()) {<br />&nbsp;&nbsp;&nbsp;&nbsp;xt.NavigateToCoordinates(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;55.43019,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;12.26075);<br />&nbsp;&nbsp;}<br />}<br /><font color="blue">catch</font> (<font color="#408080">GarminNativeException</font> ex) {<br />&nbsp;&nbsp;<font color="#408080">Debug</font>.Assert(<font color="blue">false</font>, ex.Message, ex.StackTrace);<br />}<br /></font><br />For showing an address on the map:<br /><font face="courier"><br /><font color="blue">try</font> {<br />&nbsp;&nbsp;<font color="blue">using</font> (<font color="#408080">GarminXT</font> xt = <font color="blue">new</font> <font color="#408080">GarminXT</font>()) {<br />&nbsp;&nbsp;&nbsp;&nbsp;xt.ShowAddressOnMap(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="red">"Hørkær 24"</font>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="red">"Herlev"</font>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="red">"2730"</font>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">null</font>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="red">"Denmark"</font>);<br />&nbsp;&nbsp;}<br />}<br /><font color="blue">catch</font> (<font color="#408080">GarminNativeException</font> ex) {<br />&nbsp;&nbsp;<font color="#408080">Debug</font>.Assert(<font color="blue">false</font>, ex.Message, ex.StackTrace);<br />}<br /></font><br /><br />That wasn't that hard was it?<br /><br />But there is one thing that I don't quite understand. Why do we have to wrap SDK's like this ourselves? Why don't they just provide managed SDK's? Hopefully this will change in the near future. Until then, I guess I can just write a few more articles about it.