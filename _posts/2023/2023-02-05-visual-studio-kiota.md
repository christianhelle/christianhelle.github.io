---
layout: post
title: Generate REST API Clients using Visual Studio and Microsoft Kiota
date: '2023-02-05'
author: Christian Helle
tags: 
- REST
- OpenAPI
- Kiota
- Visual Studio
redirect_from:
- /2023/02/visual-studio-kiota/
- /2023/02/visual-studio-kiota
- /2023/visual-studio-kiota/
- /2023/visual-studio-kiota
- /visual-studio-kiota/
- /visual-studio-kiota
---

A week ago while I was browsing around what's trending on Github, I stumbled upon something called [Microsoft Kiota](https://github.com/microsoft/kiota?WT.mc_id=DT-MVP-5004822). [Kiota](https://github.com/microsoft/kiota?WT.mc_id=DT-MVP-5004822) is a command line tool for generating an API client to call any OpenAPI described API you are interested in. Getting started was quite a good experience as documentation from project Kiota is quite decent, especially for [Building SDK's in .NET](https://learn.microsoft.com/en-us/openapi/kiota/quickstarts/dotnet?WT.mc_id=DT-MVP-5004822). 

Since [Kiota](https://github.com/microsoft/kiota?WT.mc_id=DT-MVP-5004822) is a .NET Tool and distributed on [nuget.org](https://www.nuget.org/packages/Microsoft.OpenApi.Kiota), installation is as simple as

```
dotnet tool install --global --prerelease Microsoft.OpenApi.Kiota
```

The command line arguments for [Kiota](https://github.com/microsoft/kiota?WT.mc_id=DT-MVP-5004822) is very straight forward and looks something like this:

```
kiota generate -d [relative path to OpenAPI spec file] -n [default namespace] -o [relative output path]
```

The code generated by [Microsoft Kiota](https://github.com/microsoft/kiota?WT.mc_id=DT-MVP-5004822) depends on the following NuGet packages:
- [Microsoft.Kiota.Abstractions](https://www.nuget.org/packages/Microsoft.Kiota.Abstractions/1.0.0-rc.6)
- [Microsoft.Kiota.Http.HttpClientLibrary](https://www.nuget.org/packages/Microsoft.Kiota.Http.HttpClientLibrary/1.0.0-rc.5)
- [Microsoft.Kiota.Serialization.Form](https://www.nuget.org/packages/Microsoft.Kiota.Serialization.Form/1.0.0-rc.3)
- [Microsoft.Kiota.Serialization.Json](https://www.nuget.org/packages/Microsoft.Kiota.Serialization.Json/1.0.0-rc.3)
- [Microsoft.Kiota.Serialization.Text](https://www.nuget.org/packages/Microsoft.Kiota.Serialization.Text/1.0.0-rc.3)
- [Microsoft.Kiota.Authentication.Azure](https://www.nuget.org/packages/Microsoft.Kiota.Authentication.Azure/1.0.0-rc.3)
- [Azure.Identity](https://www.nuget.org/packages/Azure.Identity/1.8.1)

Kiota is built to target .NET 7.0 so this is required to run [Kiota](https://github.com/microsoft/kiota?WT.mc_id=DT-MVP-5004822). The code C# generated by Kiota builds on the following .NET versions:
- .NET 7.0 and 6.0
- .NET Standard 2.1 and 2.0
- .NET Framework 4.8.1, 4.8, 4.7.2, 4.6.2

All this perfectly fits the requirements I have in my Visual Studio extension, [REST API Client Code Generator](https://marketplace.visualstudio.com/items?itemName=ChristianResmaHelle.ApiClientCodeGenerator), so I immediately got started with integrating [Kiota](https://github.com/microsoft/kiota?WT.mc_id=DT-MVP-5004822) in my extension

![](/assets/images/vs-kiota-generator.png)

After generating code, the extension will install the required NuGet packages and configure the project to use a Custom Tool on the OpenAPI Swagger file

![](/assets/images/vs-kiota-generator-after.png)

Currently my tool just installs and runs the [Kiota](https://github.com/microsoft/kiota?WT.mc_id=DT-MVP-5004822) CLI tool, so there is a slight pause in Visual Studio while the custom tool is running, because Visual Studio needs to start an external process and wait for the results

Here's an example of how to use the Kiota generated code from the [Swagger Petstore](https://petstore3.swagger.io) [OpenAPI specifications example](https://petstore3.swagger.io/api/v3/openapi.yaml).

```csharp
using Microsoft.Kiota.Http.HttpClientLibrary;
using Microsoft.Kiota.Abstractions.Authentication;

var authProvider = new AnonymousAuthenticationProvider();
var requestAdapter = new HttpClientRequestAdapter(authProvider);
requestAdapter.BaseUrl = "https://petstore3.swagger.io/api/v3";

var client = new ApiClient(requestAdapter);
var pet = await client.Pet["0"].GetAsync(c => c.Headers.Add("accept", "application/json"));

Console.WriteLine($"Name: {pet.Name}");
Console.WriteLine($"Category: {pet.Category.Name}");
Console.WriteLine($"Status: {pet.Status}");
```

The code above outputs the following:

```
Name: doggie
Category: Dogs
Status: Available
```

It is the equivalent of calling the Swagger Petstore API using cURL

```
curl -X 'GET' 'https://petstore3.swagger.io/api/v3/pet/0' -H 'accept: application/json'
```

which responds with

```json
{
   "id":0,
   "category":{
      "id":1,
      "name":"Dogs"
   },
   "name":"doggie",
   "photoUrls":[
      "string"
   ],
   "tags":[
      {
         "id":0,
         "name":"string"
      }
   ],
   "status":"available"
}
```

I think [Kiota](https://github.com/microsoft/kiota?WT.mc_id=DT-MVP-5004822) is really promising and I think that you should also give it a shot. You can use it via my Visual Studio extension [REST API Client Code Generator](https://marketplace.visualstudio.com/items?itemName=ChristianResmaHelle.ApiClientCodeGenerator), my CLI tool [Rapicgen](https://www.nuget.org/packages/rapicgen#readme-body-tab), or via the Kiota CLI Tool directly