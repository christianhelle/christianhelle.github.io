---
layout: post
title: How to convert an image to gray scale in WPF
date: '2011-02-01T12:22:00.000+01:00'
# author: Christian Resma Helle
tags:
- Image Manipulation
- WPF
modified_time: '2011-02-01T12:22:38.038+01:00'
blogger_id: tag:blogger.com,1999:blog-4995334164049002857.post-7134900830504549198
blogger_orig_url: https://christian-helle.blogspot.com/2011/02/how-to-convert-image-to-gray-scale-in.html
---

I've been playing with the Windows Presentation Foundation today and I had a task where I needed to convert an image to gray scale to do some image analysis on it. I've done this a bunch of times before using GDI methods or by accessing the BitmapData class in .NET. For this short post I'd like to demonstrate how to manipulate images using the WriteableBitmap class.  <br /><br />The easiest way to convert an image to gray scale is to set the RGB values of every pixel to the average of each pixels RBG values.  <br />R = (R + B + G) / 3 <br />G = (R + B + G) / 3 <br />B = (R + B + G) / 3  <br /><br />Here's a code snippet for manipulating a BitmapSource object using the WriteableBitmap class into a gray scale image:  <br /><br /><div style="font-family: Courier New; font-size: 10pt; color: black; background: white;"><pre style="margin: 0px;"><span style="color: blue;">public</span> <span style="color: blue;">unsafe</span> <span style="color: blue;">static</span> <span style="color: #2b91af;">BitmapSource</span> ToGrayScale(<span style="color: #2b91af;">BitmapSource</span> source)</pre><pre style="margin: 0px;">{</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">const</span> <span style="color: blue;">int</span> PIXEL_SIZE = 4;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> width = source.PixelWidth;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> height = source.PixelHeight;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> bitmap = <span style="color: blue;">new</span> <span style="color: #2b91af;">WriteableBitmap</span>(source);</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; bitmap.Lock();</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> backBuffer = (<span style="color: blue;">byte</span>*)bitmap.BackBuffer.ToPointer();</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">for</span> (<span style="color: blue;">int</span> y = 0; y &lt; height; y++)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> row = backBuffer + (y * bitmap.BackBufferStride);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">for</span> (<span style="color: blue;">int</span> x = 0; x &lt; width; x++)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> grayScale = (<span style="color: blue;">byte</span>)(((row[x * PIXEL_SIZE + 1]) + (row[x * PIXEL_SIZE + 2]) + (row[x * PIXEL_SIZE + 3])) / 3);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">for</span> (<span style="color: blue;">int</span> i = 0; i &lt; PIXEL_SIZE; i++)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; row[x * PIXEL_SIZE + i] = grayScale;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; bitmap.AddDirtyRect(<span style="color: blue;">new</span> <span style="color: #2b91af;">Int32Rect</span>(0, 0, width, height));</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; bitmap.Unlock();</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span> bitmap;</pre><pre style="margin: 0px;">}</pre></div> <br /><br />Another way to to convert an image to gray scale is to set the RGB values of every pixel to the sum of 30% of the red value, 59% of the green value, and 11% of the blue value. Hope you find this useful.