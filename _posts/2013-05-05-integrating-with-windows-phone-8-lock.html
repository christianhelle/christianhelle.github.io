---
layout: post
title: Integrating with the Windows Phone 8 Lock Screen
date: '2013-05-05T23:31:00.000+02:00'
# author: Christian Resma Helle
tags:
- Windows Phone 8
modified_time: '2013-05-06T17:02:52.269+02:00'
thumbnail: http://lh6.ggpht.com/--tghTed1JPs/UXWn7qFyc7I/AAAAAAAADFg/ih6cMqbzzKk/s72-c/settings_thumb%25255B1%25255D.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-4995334164049002857.post-5193764592110998860
blogger_orig_url: https://christian-helle.blogspot.com/2013/05/integrating-with-windows-phone-8-lock.html
---

A nice new feature in Windows Phone 8 is integration with the lock screen. As a developer, you can now display notification icons the same way the Outlook app displays New Mail notifications. You can also change the background image of the lock screen from your app. The information used for displaying notification is the exact same information that an app uses to display notifications on the app’s primary tile regardless if the app is pinned to the start screen or not <br /><br /><strong>Notification Icon</strong><br /><br />To display an icon on the lock screen you must follow a small set of strict rules on how your image file should be. The image has to be a<strong> 38 x 38 PNG image that contains only white pixels and some levels of transparency</strong>. Yes, I know it’s a bit strict but it makes sense as the icon notifications are designed to be very discreet. <br /><strong><br /></strong><strong>App Manifest</strong><br /><br />You need to define a few extensions to let the operating system allow your app to integrate with the lock screen. So here’s what we need to do, open the WMAppManifest.xml file using an XML editor, to do this right click on the WMAppManifest.xml file and select <strong>Open With</strong>, and use the <strong>XML (Text) Editor</strong>. First, we need to define the <strong>&lt;DeviceLockImageURI&gt;</strong> element in the primary token. The DeviceLockImageURI describes which image file to display in the lock screen as an icon. To define DeviceLockImageURI, insert the following element in the <strong>&lt;PrimaryToken&gt;</strong> <br /><blockquote><pre style="background: white; color: black; font-family: consolas; font-size: 13px;"><span style="color: blue;">&lt;</span><span style="color: #a31515;">DeviceLockImageURI</span><span style="color: blue;">&nbsp;</span><span style="color: red;">IsRelative</span><span style="color: blue;">=</span>"<span style="color: blue;">true</span>"<br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: red;">IsResource</span><span style="color: blue;">=</span>"<span style="color: blue;">false</span>"<span style="color: blue;">&gt;</span>Assets\YourLockImage.png<span style="color: blue;">&lt;/</span><span style="color: #a31515;">DeviceLockImageURI</span><span style="color: blue;">&gt;</span></pre></blockquote>Then, insert the following lines after the between the <strong>&lt;Tokens&gt;</strong> and <strong>&lt;ScreenResolutions&gt;</strong> definitions<br /><blockquote><pre style="background: white; color: black; font-family: consolas; font-size: 13px;"><span style="color: blue;">&lt;</span><span style="color: #a31515;">Extensions</span><span style="color: blue;">&gt;</span><br /><span style="color: blue;">&nbsp; &lt;</span><span style="color: #a31515;">Extension</span><span style="color: blue;">&nbsp;</span><span style="color: red;">ExtensionName</span><span style="color: blue;">=</span>"<span style="color: blue;">LockScreen_Notification_IconCount</span>"<br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: red;">ConsumerID</span><span style="color: blue;">=</span>"<span style="color: blue;">{111DFF24-AA15-4A96-8006-2BFF8122084F}</span>"<br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: red;">TaskID</span><span style="color: blue;">=</span>"<span style="color: blue;">_default</span>"<span style="color: blue;"> /&gt;</span><br /><span style="color: blue;">&nbsp; &lt;</span><span style="color: #a31515;">Extension</span><span style="color: blue;">&nbsp;</span><span style="color: red;">ExtensionName</span><span style="color: blue;">=</span>"<span style="color: blue;">LockScreen_Notification_TextField</span>"<br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: red;">ConsumerID</span><span style="color: blue;">=</span>"<span style="color: blue;">{111DFF24-AA15-4A96-8006-2BFF8122084F}</span>"<br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: red;">TaskID</span><span style="color: blue;">=</span>"<span style="color: blue;">_default</span>"<span style="color: blue;"> /&gt;</span><br /><span style="color: blue;">&nbsp; &lt;</span><span style="color: #a31515;">Extension</span><span style="color: blue;">&nbsp;</span><span style="color: red;">ExtensionName</span><span style="color: blue;">=</span>"<span style="color: blue;">LockScreen_Background</span>"<br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: red;">ConsumerID</span><span style="color: blue;">=</span>"<span style="color: blue;">{111DFF24-AA15-4A96-8006-2BFF8122084F}</span>"<br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: red;">TaskID</span><span style="color: blue;">=</span>"<span style="color: blue;">_default</span>"<span style="color: blue;"> /&gt;</span><br /><span style="color: blue;">&lt;/</span><span style="color: #a31515;">Extensions</span><span style="color: blue;">&gt;</span></pre><br /></blockquote><strong>Lock screen settings</strong><br /><br />Before our app can display notifications we need to configure our Lock Screen settings to allow the type of notification that we are interested in displaying. Currently an app can display 3 types of notifications: background image; detailed status; and quick status. Detailed status is similar to the textual calendar notifications that are displayed using the Outlook Calendar app. Quick status is similar to the way the Outlook Mail app displays notifications, an icon and a count indicator.<br /><br />To configure the device to display notifications from your app, go to the settings app and select Lock screen <br /><br /><a href="http://lh5.ggpht.com/-lfeyk0bPGvM/UXWn0xJI-iI/AAAAAAAADFc/NO9mBQR8FA8/s1600-h/settings%25255B3%25255D.png"><img alt="settings" border="0" height="804" src="http://lh6.ggpht.com/--tghTed1JPs/UXWn7qFyc7I/AAAAAAAADFg/ih6cMqbzzKk/settings_thumb%25255B1%25255D.png?imgmax=800" style="border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px; display: inline;" title="settings" width="484" /></a> <br /><br />In the lock screen settings, choose the notification type that will display notifications from our app<br /><br /><a href="http://lh3.ggpht.com/-it0vr-dA13A/UXWn8Jmp51I/AAAAAAAADFo/UEflSF2kKLY/s1600-h/image%25255B12%25255D.png"><img alt="image" border="0" height="804" src="http://lh3.ggpht.com/-C_RetikC3Ok/UXWn9Fzh1pI/AAAAAAAADFw/a7arSl9p5qI/image_thumb%25255B6%25255D.png?imgmax=800" style="border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px; display: inline;" title="image" width="484" /></a><br /><br />For this example we’ll show a quick status notification<br /><br /><a href="http://lh3.ggpht.com/-LIB-eOQqh7k/UXWn9s-rG9I/AAAAAAAADF4/IgzfDyNrgSA/s1600-h/quick%252520status%252520on%25255B5%25255D.png"><img alt="quick status on" border="0" height="804" src="http://lh3.ggpht.com/-Blwu72A0ags/UXWn-1FadzI/AAAAAAAADGA/CKrpwD6H_y0/quick%252520status%252520on_thumb%25255B3%25255D.png?imgmax=800" style="border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px; display: inline;" title="quick status on" width="484" /></a><br /><br /><strong>Code</strong><br /><br />To update the background image of the lock screen we need use the <a href="http://msdn.microsoft.com/en-us/library/windowsphone/develop/windows.phone.system.userprofile.lockscreen(v=vs.105).aspx">LockScreen</a> class of the <a href="http://msdn.microsoft.com/en-us/library/windowsphone/develop/jj207562(v=vs.105).aspx">UserProfile</a> API. First we check if the user configured the app to be able to set the background of the lock screen, we can do this through <a href="http://msdn.microsoft.com/en-us/library/windowsphone/develop/windows.phone.system.userprofile.lockscreenmanager(v=vs.105).aspx">LockScreenManager</a> class. If the app isn’t allowed to change the lock screen background then we can open the lock screen settings page.<br /><div class="wlWriterEditableSmartContent" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:c861d3b8-ab99-412c-a2dc-ec68782562dd" style="display: inline; float: none; margin: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><br /><div style="border: #000080 1px solid; color: black; font-family: 'Courier New', Courier, Monospace; font-size: 10pt;"><div style="background: #000080; color: white; font-family: Verdana, Tahoma, Arial, sans-serif; font-weight: bold; padding: 2px 5px;">Lock screen background (C#)</div><br /><div style="background-color: white; overflow: auto; padding: 2px 5px; white-space: nowrap;"><span style="background: #ffffff; color: blue;">if</span><span style="background: #ffffff; color: black;"> (</span><span style="background: #ffffff; color: blue;">await</span><span style="background: #ffffff; color: black;"> </span><span style="background: #ffffff; color: #2b91af;">LockScreenManager</span><span style="background: #ffffff; color: black;">.RequestAccessAsync() == </span><span style="background: #ffffff; color: #2b91af;">LockScreenRequestResult</span><span style="background: #ffffff; color: black;">.Granted)</span><br /><span style="font-size: 10pt;">{</span><br /><span style="color: black; font-size: 10pt;">&nbsp; &nbsp;&nbsp;</span><span style="color: blue; font-size: 10pt;">var</span><span style="color: black; font-size: 10pt;"> uri = </span><span style="color: blue; font-size: 10pt;">new</span><span style="color: black; font-size: 10pt;"> </span><span style="color: #2b91af; font-size: 10pt;">Uri</span><span style="color: black; font-size: 10pt;">(</span><span style="color: #a31515; font-size: 10pt;">"ms-appx:///Assets/LockScreenImage.png"</span><span style="color: black; font-size: 10pt;">, </span><span style="color: #2b91af; font-size: 10pt;">UriKind</span><span style="color: black; font-size: 10pt;">.Absolute);</span><br /><span style="color: black; font-size: 10pt;">&nbsp; &nbsp;&nbsp;</span><span style="color: #2b91af; font-size: 10pt;">LockScreen</span><span style="color: black; font-size: 10pt;">.SetImageUri(uri);</span><br /><span style="font-size: 10pt;">}</span><br /><span style="color: blue; font-size: 10pt;">else</span><br /><span style="font-size: 10pt;">{</span><br /><span style="color: black; font-size: 10pt;">&nbsp; &nbsp;&nbsp;</span><span style="color: green; font-size: 10pt;">// Open the Settings -&gt; Lock Screen settings</span><br /><span style="color: black; font-size: 10pt;">&nbsp; &nbsp;&nbsp;</span><span style="color: blue; font-size: 10pt;">await</span><span style="color: black; font-size: 10pt;"> </span><span style="color: #2b91af; font-size: 10pt;">Launcher</span><span style="color: black; font-size: 10pt;">.LaunchUriAsync(</span><span style="color: blue; font-size: 10pt;">new</span><span style="color: black; font-size: 10pt;"> </span><span style="color: #2b91af; font-size: 10pt;">Uri</span><span style="color: black; font-size: 10pt;">(</span><span style="color: #a31515; font-size: 10pt;">"ms-settings-lock:"</span><span style="color: black; font-size: 10pt;">));</span><br /><span style="font-size: 10pt;">}</span></div><br /></div><br /></div>To display an icon notification just update the primary application tile with a notification. We can do this by using the <a href="http://msdn.microsoft.com/en-US/library/windowsphone/develop/microsoft.phone.shell.shelltile(v=vs.105).aspx">ShellTile</a> API<br /><br /><div class="wlWriterEditableSmartContent" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:50f569cd-6a48-4f82-a5d5-64596ddca759" style="display: inline; float: none; margin: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><div style="border: #000080 1px solid; color: black; font-family: 'Courier New', Courier, Monospace; font-size: 10pt;"><div style="background: #000080; color: white; font-family: Verdana, Tahoma, Arial, sans-serif; font-weight: bold; padding: 2px 5px;">Display notification (C#)</div><div style="background-color: white; overflow: auto; padding: 2px 5px; white-space: nowrap;"><span style="background: #ffffff; color: blue;"><br /></span><span style="background: #ffffff; color: blue;">var</span><span style="background: #ffffff; color: black;"> tile = </span><span style="background: #ffffff; color: #2b91af;">ShellTile</span><span style="background: #ffffff; color: black;">.ActiveTiles.First();</span><br /><span style="color: blue; font-size: 10pt;">var</span><span style="color: black; font-size: 10pt;"> data = </span><span style="color: blue; font-size: 10pt;">new</span><span style="color: black; font-size: 10pt;"> </span><span style="color: #2b91af; font-size: 10pt;">FlipTileData</span><br /><span style="font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span><br /><span style="font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Count = 1,</span><br /><span style="color: black; font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Title = </span><span style="color: #a31515; font-size: 10pt;">"Lock Screen Demo"</span><br /><span style="font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };</span><br /><span style="font-size: 10pt;">tile.Update(data);</span></div><br /></div><br /></div>To clear the notification just update the primary application tile to its original state <br /><br /><div class="wlWriterEditableSmartContent" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:c7c41e76-6182-40b7-abd1-3927ab2741d2" style="display: inline; float: none; margin: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><div style="border: #000080 1px solid; color: black; font-family: 'Courier New', Courier, Monospace; font-size: 10pt;"><div style="background: #000080; color: white; font-family: Verdana, Tahoma, Arial, sans-serif; font-weight: bold; padding: 2px 5px;">Clear notification (C#)</div><br /><div style="background-color: white; overflow: auto; padding: 2px 5px; white-space: nowrap;"><span style="background: #ffffff; color: blue;">var</span><span style="background: #ffffff; color: black;"> tile = </span><span style="background: #ffffff; color: #2b91af;">ShellTile</span><span style="background: #ffffff; color: black;">.ActiveTiles.First();</span><br /><span style="color: blue; font-size: 10pt;">var</span><span style="color: black; font-size: 10pt;"> data = </span><span style="color: blue; font-size: 10pt;">new</span><span style="color: black; font-size: 10pt;"> </span><span style="color: #2b91af; font-size: 10pt;">FlipTileData</span><br /><span style="font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span><br /><span style="font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Count = 0,</span><br /><span style="color: black; font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Title = </span><span style="color: #a31515; font-size: 10pt;">"Lock Screen Demo"</span><br /><span style="font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };</span><br /><span style="font-size: 10pt;">tile.Update(data);</span></div><br /></div><br /></div>Pretty simple isn’t it?<br /><br /><strong>Testing on the Emulator </strong><br /><br />To test on the Windows Phone emulator you can use the <a href="http://msdn.microsoft.com/en-us/library/windowsphone/develop/jj206953(v=vs.105).aspx">Simulation Dashboard</a> which integrates directly into Visual Studio. To launch this, go to Tools –&gt; Simulation Dashboard. You can use this tool to Lock and Unlock the emulator to test your apps lock screen integration<br /><br /><a href="http://lh3.ggpht.com/-7CSROQfwGg8/UXWn_nU_XKI/AAAAAAAADGM/5q6usj_wWvY/s1600-h/image%25255B3%25255D.png"><img alt="image" border="0" height="602" src="http://lh4.ggpht.com/-2vxCdaJ7sd8/UXWoC-Q_4-I/AAAAAAAADGU/azHUwDrKR2w/image_thumb%25255B1%25255D.png?imgmax=800" style="border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px; display: inline;" title="image" width="407" /></a><br /><br />I hope you found this interesting. You can grab the source code here<br /><br /><iframe frameborder="0" height="120" scrolling="no" src="https://skydrive.live.com/embed?cid=CA531E7FB4762C70&amp;resid=CA531E7FB4762C70%2137080&amp;authkey=AOXEBkTA6wCceKI" width="98"></iframe>  