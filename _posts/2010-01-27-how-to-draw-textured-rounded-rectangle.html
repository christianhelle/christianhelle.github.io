---
layout: post
title: How to draw a textured rounded rectangle in .NETCF
date: '2010-01-27T07:41:00.039+01:00'
author: Christian Resma Helle
tags:
- Graphics
- How to
- ".NET Compact Framework"
modified_time: '2010-01-27T08:52:50.629+01:00'
blogger_id: tag:blogger.com,1999:blog-4995334164049002857.post-7170025817190813789
blogger_orig_url: https://christian-helle.blogspot.com/2010/01/how-to-draw-textured-rounded-rectangle.html
---

I'd like to demonstrate how to draw patterned rounded rectangles by P/Invoking the GDI function <a href="http://msdn.microsoft.com/en-us/library/aa929212.aspx">RoundRect</a> using a patterned brush instead of a solid brush. Let's create an extension method called FillRoundedTexturedRectangle to the Graphics class. With this method we can fill rectangles with an image. This image will be drawn as tiles to fill the rectangle bounds. This method can come in handy for drawing complex textures or patterns into a rectangle. With a little alpha blending and gradient fills, one can achieve a modern glass effect in the user interface<br /><br />We create our brush with the <a href="http://msdn.microsoft.com/en-us/library/ms908179.aspx">CreatePatternBrush</a> function instead of <a href="http://msdn.microsoft.com/en-us/library/ms959979.aspx">CreateSolidBrush</a> as we did in my previous article on <a href="http://christian-helle.blogspot.com/2010/01/how-to-draw-rounded-rectangle-in-netcf.html">How to draw a rounded rectangle in .NETCF</a>. We will mostly use P/Invoke for creating and releasing GDI objects.<br /><br /><div style="font-family: Fixedsys; font-size: 10pt; color: black; background: white;"><pre style="margin: 0px;"><span style="color: blue;">const</span> <span style="color: blue;">int</span> PS_SOLID = 0;</pre><pre style="margin: 0px;"><span style="color: blue;">const</span> <span style="color: blue;">int</span> PS_DASH = 1;</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">[<span style="color: #2b91af;">DllImport</span>(<span style="color: #a31515;">&quot;coredll.dll&quot;</span>)]</pre><pre style="margin: 0px;"><span style="color: blue;">static</span> <span style="color: blue;">extern</span> <span style="color: #2b91af;">IntPtr</span> CreatePen(<span style="color: blue;">int</span> fnPenStyle, <span style="color: blue;">int</span> nWidth, <span style="color: blue;">uint</span> crColor);</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">[<span style="color: #2b91af;">DllImport</span>(<span style="color: #a31515;">&quot;coredll.dll&quot;</span>)]</pre><pre style="margin: 0px;"><span style="color: blue;">static</span> <span style="color: blue;">extern</span> <span style="color: blue;">int</span> SetBrushOrgEx(<span style="color: #2b91af;">IntPtr</span> hdc, <span style="color: blue;">int</span> nXOrg, <span style="color: blue;">int</span> nYOrg, <span style="color: blue;">ref</span> Point lppt);</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">[<span style="color: #2b91af;">DllImport</span>(<span style="color: #a31515;">&quot;coredll.dll&quot;</span>)]</pre><pre style="margin: 0px;"><span style="color: blue;">static</span> <span style="color: blue;">extern</span> <span style="color: #2b91af;">IntPtr</span> SelectObject(<span style="color: #2b91af;">IntPtr</span> hdc, <span style="color: #2b91af;">IntPtr</span> hgdiobject);</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">[<span style="color: #2b91af;">DllImport</span>(<span style="color: #a31515;">&quot;coredll.dll&quot;</span>)]</pre><pre style="margin: 0px;"><span style="color: blue;">static</span> <span style="color: blue;">extern</span> <span style="color: blue;">bool</span> DeleteObject(<span style="color: #2b91af;">IntPtr</span> hObject);</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">[<span style="color: #2b91af;">DllImport</span>(<span style="color: #a31515;">&quot;coredll.dll&quot;</span>)]</pre><pre style="margin: 0px;"><span style="color: blue;">static</span> <span style="color: blue;">extern</span> <span style="color: #2b91af;">IntPtr</span> CreatePatternBrush(<span style="color: #2b91af;">IntPtr</span> hbmp);</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">[<span style="color: #2b91af;">DllImport</span>(<span style="color: #a31515;">&quot;coredll.dll&quot;</span>)]</pre><pre style="margin: 0px;"><span style="color: blue;">static</span> <span style="color: blue;">extern</span> <span style="color: blue;">bool</span> RoundRect(</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">IntPtr</span> hdc, </pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> nLeftRect, </pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> nTopRect, </pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> nRightRect, </pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> nBottomRect, </pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> nWidth, </pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> nHeight);</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;"><span style="color: blue;">static</span> <span style="color: blue;">uint</span> GetColorRef(Color value)</pre><pre style="margin: 0px;">{</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span> 0x00000000 | ((<span style="color: blue;">uint</span>)value.B &lt;&lt; 16) | ((<span style="color: blue;">uint</span>)value.G &lt;&lt; 8) | (<span style="color: blue;">uint</span>)value.R;</pre><pre style="margin: 0px;">}</pre></div><br />Now we have our P/Invoke definitions in place we can neatly wrap all P/Invoke operations in a single function and let's call that FillRoundedTexturedRectangle()<br /><br /><div style="font-family: Fixedsys; font-size: 10pt; color: black; background: white;"><pre style="margin: 0px;"><span style="color: blue;">public</span> <span style="color: blue;">static</span> <span style="color: blue;">void</span> FillRoundedTexturedRectangle(</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">this</span> <span style="color: #2b91af;">Graphics</span> graphics,</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">Pen</span> border,</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">Bitmap</span> texture,</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">Rectangle</span> rectangle,</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">Size</span> ellipseSize)</pre><pre style="margin: 0px;">{</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> lppt = <span style="color: blue;">new</span> <span style="color: #2b91af;">Point</span>();</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> hdc = graphics.GetHdc();</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> style = border.DashStyle == <span style="color: #2b91af;">DashStyle</span>.Solid ? PS_SOLID : PS_DASH;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> hpen = CreatePen(style, (<span style="color: blue;">int</span>)border.Width, GetColorRef(border.Color));</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> hbrush = CreatePatternBrush(texture.GetHbitmap());</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">try</span></pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; SetBrushOrgEx(hdc, rectangle.Left, rectangle.Top, <span style="color: blue;">ref</span> lppt);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; SelectObject(hdc, hpen);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; SelectObject(hdc, hbrush);</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; RoundRect(hdc,</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; rectangle.Left,</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; rectangle.Top,</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; rectangle.Right,</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; rectangle.Bottom,</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; ellipseSize.Width,</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; ellipseSize.Height);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">finally</span></pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; SetBrushOrgEx(hdc, lppt.Y, lppt.X, <span style="color: blue;">ref</span> lppt);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; DeleteObject(hpen);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; DeleteObject(hbrush);</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; graphics.ReleaseHdc(hdc);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">}</pre></div><br />To use this extension method you need to create a Bitmap and a Pen. The pen will be used to draw the rounded border, and the Bitmap will be used as a fill (tiled). Here's an example where "e" is an instance of PaintEventArgs<br /><br /><div style="font-family: Fixedsys; font-size: 10pt; color: black; background: white;"><pre style="margin: 0px;"><span style="color: blue;">using</span> (<span style="color: blue;">var</span> pen = <span style="color: blue;">new</span> <span style="color: #2b91af;">Pen</span>(<span style="color: #2b91af;">SystemColors</span>.Highlight, 5))</pre><pre style="margin: 0px;"><span style="color: blue;">using</span> (<span style="color: blue;">var</span> texture = <span style="color: blue;">new</span> <span style="color: #2b91af;">Bitmap</span>(<span style="color: #a31515;">@&quot;\windows\msn.gif&quot;</span>))</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; e.Graphics.FillRoundedTexturedRectangle(pen, </pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; texture, </pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ClientRectangle, </pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">new</span> <span style="color: #2b91af;">Size</span>(8, 8));</pre></div><br /><br />I hope you found this useful. If you're interested in the full source code then you can grab it <a href="http://cid-ca531e7fb4762c70.skydrive.live.com/self.aspx/Code%20Samples/TexturedRoundedRectangle.cs">here</a>