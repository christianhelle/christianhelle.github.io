---
layout: post
title: AppCenter Extensions for ASP.NET Core and Application Insights
date: '2020-03-01T21:31:00.001+01:00'
# author: Christian Helle
tags:
- Azure
- Xamarin
- AppCenter
modified_time: '2020-03-01T21:32:22.348+01:00'
blogger_id: tag:blogger.com,1999:blog-4995334164049002857.post-6120354957540588816
blogger_orig_url: https://christian-helle.blogspot.com/2020/03/appcenter-extensions-for-aspnet-core.html
---

In my <a href="/2020/02/appcenter-extensions-for-xamarinforms.html">previous post</a>, I wrote about an open source project called <a href="https://github.com/christianhelle/appcenterextensions">AppCenterExtensions</a> available at Github and nuget.org. I recently updated this project and added a few components for ASP.NET Core that enables including AppCenter diagnostic information in Application Insights.<br /><br />The NuGet package is called <a href="https://www.nuget.org/packages/AppCenterExtensions.AppInsights">AppCenterExtensions.AppInsights</a> and contains extension methods and <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.applicationinsights.extensibility.itelemetryinitializer">ITelemetryInitializer</a> implementations to be used in a ASP.NET Core web app for including AppCenter diagnostic information when logging to Application Insights <br /><br />Enabling this is easy. Assuming that the project is already configured to use Application Insights, just add the&nbsp;<a href="https://www.nuget.org/packages/AppCenterExtensions.AppInsights">AppCenterExtensions.AppInsights</a>&nbsp;NuGet package mentioned above to your ASP.NET Core and call <b>services.AddAppCenterTelemetry()</b>&nbsp;in the <b>ConfigureServices</b> method of the <b>Startup</b> class<br /><br />Here's an example:<br /><br /><pre><code><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Startup</span><br />{<br />    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Startup</span>(<span class="hljs-params">IConfiguration configuration</span>)<br />    </span>{<br />        Configuration = configuration;<br />    }<br /><br />    <span class="hljs-keyword">public</span> IConfiguration Configuration { <span class="hljs-keyword">get</span>; }<br /><br />    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)<br />    </span>{<br />        <span class="hljs-comment">// Configure and register services to the IoC</span><br /><br />        services.AddApplicationInsightsTelemetry();<br />        services.AddAppCenterTelemetry();<br />    }<br /><br />    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Configure</span>(<span class="hljs-params">IApplicationBuilder app, IWebHostEnvironment env</span>)<br />    </span>{<br />        <span class="hljs-comment">// Configure app</span><br />    }<br />}<br /></code></pre><br />Once this is setup, AppCenter diagnostic information should now be searchable and visible in Application Insights.<br /><br />Here's a screenshot of search results for the <strong>x-supportkey</strong> header<br /><br /><img src="https://github.com/christianhelle/appcenterextensions/blob/master/images/appinsights-search-result.png?raw=true" /><br /><br />and here's a screenshot of the details of a single request containing AppCenter diagnostic information logged in Application Insights<br /><br /><img src="https://github.com/christianhelle/appcenterextensions/blob/master/images/appinsights-search-result-details.png?raw=true" /><br /><br />With this flow you can now correlate Crash Reports and Analytics data from AppCenter with the HTTP requests for your backend systems in Application Insights. In the systems that I have been involved with building we include the AppCenter diagnostic information from our <a href="https://docs.microsoft.com/en-us/dotnet/architecture/microservices/architect-microservice-container-applications/direct-client-to-microservice-communication-versus-the-api-gateway-pattern">API Gateway</a> to all calls to our internal Microservices<br /><br />