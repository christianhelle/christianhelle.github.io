---
layout: post
title: Transparent Controls in .NETCF
date: '2008-01-13T17:21:00.002+01:00'
# author: Christian Resma Helle
tags:
- Controls
- Transparent Controls
- Windows Mobile
- ".NET Compact Framework"
modified_time: '2009-10-12T16:00:03.529+02:00'
thumbnail: http://4.bp.blogspot.com/_kVNAYTvQ3QE/R4dD2V0d_VI/AAAAAAAAAu0/nxNdlVu_suI/s72-c/pc_capture4.jpg
blogger_id: tag:blogger.com,1999:blog-4995334164049002857.post-7179409956875335575
blogger_orig_url: https://christian-helle.blogspot.com/2008/01/transparent-controls-in-netcf.html
---

I work a lot with a graphic artist for developing solutions. The better the graphic artist you work with is, the harder it is to implement their designs to your application. One thing that my solutions have in common is that they all require transparent controls. My graphic artist loves having a image buttons on top of fancy background.<br /><br />Here's some screen shots of what I've made with my graphic artist:<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_kVNAYTvQ3QE/R4dD2V0d_VI/AAAAAAAAAu0/nxNdlVu_suI/s1600-h/pc_capture4.jpg"><img style="margin: 0pt 10px 10px 0pt; float: left; cursor: pointer;" src="http://4.bp.blogspot.com/_kVNAYTvQ3QE/R4dD2V0d_VI/AAAAAAAAAu0/nxNdlVu_suI/s200/pc_capture4.jpg" alt="" id="BLOGGER_PHOTO_ID_5154162899398032722" border="0" /></a><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://1.bp.blogspot.com/_kVNAYTvQ3QE/R4dD2l0d_WI/AAAAAAAAAu8/Jf6WJrR5sbY/s1600-h/pc_capture5.jpg"><img style="margin: 0pt 10px 10px 0pt; float: left; cursor: pointer;" src="http://1.bp.blogspot.com/_kVNAYTvQ3QE/R4dD2l0d_WI/AAAAAAAAAu8/Jf6WJrR5sbY/s200/pc_capture5.jpg" alt="" id="BLOGGER_PHOTO_ID_5154162903693000034" border="0" /></a><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://1.bp.blogspot.com/_kVNAYTvQ3QE/R4dD2l0d_XI/AAAAAAAAAvE/9MuKMT1xpww/s1600-h/pc_capture6.jpg"><img style="margin: 0pt 10px 10px 0pt; float: left; cursor: pointer;" src="http://1.bp.blogspot.com/_kVNAYTvQ3QE/R4dD2l0d_XI/AAAAAAAAAvE/9MuKMT1xpww/s200/pc_capture6.jpg" alt="" id="BLOGGER_PHOTO_ID_5154162903693000050" border="0" /></a><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://1.bp.blogspot.com/_kVNAYTvQ3QE/R4dFcl0d_aI/AAAAAAAAAvc/YRLohGLXuz0/s1600-h/main_screen.JPG"><img style="margin: 0pt 10px 10px 0pt; float: left; cursor: pointer;" src="http://1.bp.blogspot.com/_kVNAYTvQ3QE/R4dFcl0d_aI/AAAAAAAAAvc/YRLohGLXuz0/s200/main_screen.JPG" alt="" id="BLOGGER_PHOTO_ID_5154164656039656866" border="0" /></a><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_kVNAYTvQ3QE/R4dFcV0d_YI/AAAAAAAAAvM/96-uyj9HMHQ/s1600-h/pc_capture3.jpg"><img style="margin: 0pt 10px 10px 0pt; float: left; cursor: pointer;" src="http://4.bp.blogspot.com/_kVNAYTvQ3QE/R4dFcV0d_YI/AAAAAAAAAvM/96-uyj9HMHQ/s200/pc_capture3.jpg" alt="" id="BLOGGER_PHOTO_ID_5154164651744689538" border="0" /></a><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://1.bp.blogspot.com/_kVNAYTvQ3QE/R4dFcl0d_ZI/AAAAAAAAAvU/-LgbrAeenns/s1600-h/pc_capture3.jpg"><img style="margin: 0pt 10px 10px 0pt; float: left; cursor: pointer;" src="http://1.bp.blogspot.com/_kVNAYTvQ3QE/R4dFcl0d_ZI/AAAAAAAAAvU/-LgbrAeenns/s200/pc_capture3.jpg" alt="" id="BLOGGER_PHOTO_ID_5154164656039656850" border="0" /></a><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />In these screen shots I heavily use a transparent label control over a Form that has a background image. I normally set my controls to be designer visible so I can drag and drop while designing. Visual Studio 2005 and 2008 will automatically load all Custom Controls and UserControls<br /><br /><span style="font-weight: bold;">Implementing Transparent Controls</span><br /><br />For creating transparent controls, I need the following:<br /><br />1) IControlBackground interface - contains BackgroundImage { get; }<br />2) TransparentControlBase - draws the BackgroundImage of an IControlBackground form<br />3) Transparent Control - Inherits from TransparentControlBase<br />4) FormBase Form - implements IControlBackground and draws the background image to the form<br /><br />Let's start off with the IControlBackground interface. Like I mentioned above, it only contains a property called BackgroundImage.<br /><font face="courier"><br /><font color="blue">public interface</font> <font color="#408080">IControlBackground</font><br />{<br />&nbsp;&nbsp;<font color="#408080">Image</font> BackgroundImage { <font color="blue">get</font>; }<br />}<br /></font><br />Next we will need to create the TransparentControlBase. Let's create a class that inherits from Control. We then need to override the OnPaintBackground() event to draw the IControlBackground.BackgroundImage of the Parent control. To do this, we create an instance of IControlBackground from the Parent. Once we have the BackgroundImage, we draw part of the BackgroundImage where the transparent control is lying on.<br /><br />We also override the OnTextChanged() and OnParentChanged() events to force a re-draw whenever the text or parent of the control is changed.<br /><font face="courier"><br /><font color="blue">public class</font> <font color="#408080">TransparentControlBase</font> : <font color="#408080">Control</font><br />{<br />&nbsp;&nbsp;<font color="blue">protected bool</font> HasBackground = <font color="blue">false</font>;<br /><br />&nbsp;&nbsp;<font color="blue">protected override void</font> OnPaintBackground(<font color="#408080">PaintEventArgs</font> e)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#408080">IControlBackground</font> form = Parent <font color="blue">as</font> <font color="#408080">IControlBackground</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if</font> (form == <font color="blue">null</font>) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">base</font>.OnPaintBackground(e);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">return</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;} <font color="blue">else</font> {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HasBackground = <font color="blue">true</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;e.Graphics.DrawImage(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;form.BackgroundImage,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Bounds,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#408080">GraphicsUnit</font>.Pixel);<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">protected override void</font> OnTextChanged(<font color="#408080">EventArgs</font> e)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">base</font>.OnTextChanged(e);<br />&nbsp;&nbsp;&nbsp;&nbsp;Invalidate();<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">protected override void</font> OnParentChanged(<font color="#408080">EventArgs</font> e)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">base</font>.OnParentChanged(e);<br />&nbsp;&nbsp;&nbsp;&nbsp;Invalidate();<br />&nbsp;&nbsp;}<br />}<br /></font><br />Now we need to create a control that inherits from TransparentControlBase. I'll create a simple TransparentLabel control for this example. The control will have the same behavior as the standard Label control, except that it can be transparent when used over a form or control that implements IControlBackground.<br /><font face="courier"><br /><font color="blue">public class</font> <font color="#408080">TransparentLabel</font> : <font color="#408080">TransparentControlBase</font><br />{<br />&nbsp;&nbsp;<font color="#408080">ContentAlignment</font> alignment = <font color="#408080">ContentAlignment</font>.TopLeft;<br />&nbsp;&nbsp;<font color="#408080">StringFormat</font> format = <font color="blue">null</font>;<br />&nbsp;&nbsp;<font color="#408080">Bitmap</font> off_screen = <font color="blue">null</font>;<br /><br />&nbsp;&nbsp;<font color="blue">public</font> TransparentLabel()<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;format = <font color="blue">new</font> <font color="#408080">StringFormat</font>();<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">public</font> <font color="#408080">ContentAlignment</font> TextAlign<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">get</font> { <font color="blue">return</font> alignment; }<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">set</font><br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alignment = <font color="blue">value</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">switch</font> (alignment) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">case</font> <font color="#408080">ContentAlignment</font>.TopCenter:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;format.Alignment = <font color="#408080">StringAlignment</font>.Center;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;format.LineAlignment = <font color="#408080">StringAlignment</font>.Center;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">break</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">case</font> <font color="#408080">ContentAlignment</font>.TopLeft:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;format.Alignment = <font color="#408080">StringAlignment</font>.Near;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;format.LineAlignment = <font color="#408080">StringAlignment</font>.Near;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">break</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">case</font> <font color="#408080">ContentAlignment</font>.TopRight:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;format.Alignment = <font color="#408080">StringAlignment</font>.Far;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;format.LineAlignment = <font color="#408080">StringAlignment</font>.Far;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">break</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">protected override void</font> OnPaint(PaintEventArgs e)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if</font> (!<font color="blue">base</font>.HasBackground) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if</font> (off_screen == <font color="blue">null</font>) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off_screen = <font color="blue">new</font> <font color="#408080">Bitmap</font>(ClientSize.Width, ClientSize.Height);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">using</font> (<font color="#408080">Graphics</font> g = <font color="#408080">Graphics</font>.FromImage(off_screen)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">using</font> (<font color="#408080">SolidBrush</font> brush = <font color="blue">new</font> <font color="#408080">SolidBrush</font>(Parent.BackColor)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g.Clear(BackColor);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g.FillRectangle(brush, ClientRectangle);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;} <font color="blue">else</font> {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">using</font> (<font color="#408080">SolidBrush</font> brush = <font color="blue">new</font> <font color="#408080">SolidBrush</font>(ForeColor)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.Graphics.DrawString(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Text,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Font,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;brush,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">new</font> <font color="#408080">Rectangle</font>(0, 0, Width, Height),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;format);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;}<br />}<br /></font><br />Now that we have our transparent controls, we need to create a Form that will contain these controls. First we need to create a base class that will implement IControlBackground and inherit from Form.<br /><br />In this example, I added a background image to the solution and as an embedded resource. My default namespace is called TransparentSample and my background image is located at the root folder with the filename background.jpg<br /><font face="courier"><br /><font color="blue">public class</font> <font color="#408080">FormBase</font> : <font color="#408080">Form</font>, <font color="#408080">IControlBackground</font><br />{<br />&nbsp;&nbsp;<font color="#408080">Bitmap</font> background;<br /><br />&nbsp;&nbsp;<font color="blue">public</font> FormBase()<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;background = <font color="blue">new</font> <font color="#408080">Bitmap</font>(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#408080">Assembly</font>.GetExecutingAssembly().GetManifestResourceStream(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="red">"TransparentSample.background.jpg"</font>));<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">protected override void</font> OnPaint(<font color="#408080">PaintEventArgs</font> e)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;e.Graphics.DrawImage(background, 0, 0);<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">public</font> <font color="#408080">Image</font> BackgroundImage<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">get</font> { <font color="blue">return</font> background; }<br />&nbsp;&nbsp;}<br />}<br /></font><br />For the last step, we need to create a Form that will contain these transparent controls. To start, let's add a new Form to our project and let it inherit from FormBase instead of Form.<br /><br />Now we can add our transparent controls to the main form.<br /><font face="courier"><br /><font color="blue">public class</font> <font color="#408080">MainForm</font> : <font color="#408080">FormBase</font><br />{<br />&nbsp;&nbsp;<font color="#408080">TransparentLabel</font> label;<br /><br />&nbsp;&nbsp;<font color="blue">public</font> MainForm()<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;label = <font color="blue">new</font> <font color="#408080">TransparentLabel</font>();<br />&nbsp;&nbsp;&nbsp;&nbsp;label.Font = <font color="blue">new</font> <font color="#408080">Font</font>(<font color="red">"Arial"</font>, 16f, <font color="#408080">FontStyle</font>.Bold);<br />&nbsp;&nbsp;&nbsp;&nbsp;label.ForeColor = <font color="#408080">Color</font>.White;<br />&nbsp;&nbsp;&nbsp;&nbsp;label.Text = <font color="red">"Transparent Label"</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;label.Bounds = <font color="blue">new</font> <font color="#408080">Rectangle</font>(20, 60, 200, 50);<br />&nbsp;&nbsp;&nbsp;&nbsp;Controls.Add(label);<br />&nbsp;&nbsp;}<br />}<br /></font><br />That wasn't very complicated, was it? Having a nice and intuitive UI offers a very good user experience. Being creative, imaginative, and learning to work with a graphic artist can really pay off.