---
layout: post
title: Attaching Photos to a .NETCF Application
date: '2007-09-30T14:01:00.000+02:00'
author: Christian Resma Helle
tags:
- ".NET Compact Framework"
modified_time: '2007-10-01T09:15:58.471+02:00'
blogger_id: tag:blogger.com,1999:blog-4995334164049002857.post-3879352136016765784
blogger_orig_url: https://christian-helle.blogspot.com/2007/09/attaching-photos-to-netcf-application.html
---

Sorry for not posting any articles lately. I've been quite busy and didn't have time to follow up on blogs.<br /><br />Anyway, lately I've been working on a Mobile Inspection Log application for a customer. The application is rather simple and works like a small check list. The back-end server provides the mobile client with a list of Observation types where the User can set each observation to "OK", "Questionable", "Fail", and "N/A". If an Observation is questionable or failed then the user can attach a comment and a photo. The photo is then saved to a local database which can be synchronized with an access database on the users desktop computer or be sent to a web service.<br /><br />The user has 2 options for attaching photos to their observation: 1) Opening an existing photo on the file system; 2) taking a photo themselves using the built-in camera. Since the one of the requirements for the application is Windows Mobile 6.0 Professional, my job got a lot easier with the <font face="courier">Microsoft.WindowsMobile.Forms.CameraCaptureDialog</font> and the <font face="courier">Microsoft.WindowsMobile.Forms.SelectPictreDialog</font> forms<br /><br />Here's a small sample of how to use the <font face="courier">CameraCaptureDialog</font>:<br /><font face="courier"><br /><font color="blue">string</font> image_filename = <font color="blue">null</font>;<br /><font color="blue">using</font> (<font color="#408080">CameraCaptureDialog</font> camera = <font color="blue">new</font> <font color="#408080">CameraCaptureDialog</font>()) {<br />&nbsp;&nbsp;camera.Owner = <font color="blue">this</font>;<br />&nbsp;&nbsp;camera.Title = base.Text;<br />&nbsp;&nbsp;camera.Mode = <font color="#408080">CameraCaptureMode</font>.Still;<br />&nbsp;&nbsp;camera.StillQuality = <font color="#408080">CameraCaptureStillQuality</font>.High;<br /><br />&nbsp;&nbsp;<font color="blue">if</font> (camera.ShowDialog() == <font color="#408080">DialogResult</font>.OK) {<br />&nbsp;&nbsp;&nbsp;&nbsp;image_filename = camera.FileName;<br />&nbsp;&nbsp;}<br />}<br /></font><br />And for the <font face="courier">SelectPictureDialog</font>:<br /><font face="courier"><br /><font color="blue">string</font> image_filename = <font color="blue">null</font>;<br /><font color="blue">using</font> (<font color="#408080">SelectPictureDialog</font> open = <font color="blue">new</font> <font color="#408080">SelectPictureDialog</font>()) {<br />&nbsp;&nbsp;open.Filter = <font color="red">"Pictures (*.BMP;*.JPG;*.GIF)|*.BMP;*.JPG;*.GIF"</font>;<br /><br />&nbsp;&nbsp;<font color="blue">if</font> (open.ShowDialog() == <font color="#408080">DialogResult</font>.OK) {<br />&nbsp;&nbsp;&nbsp;&nbsp;image_filename = open.FileName;<br />&nbsp;&nbsp;}<br />}<br /></font><br />For saving to the local database I simply convert an Image to byte[]. I do this by:<br /><font face="courier"><br /><font color="blue">public static byte</font>[] ImageToByteArray(<font color="#408080">Image</font> image, <font color="#408080">ImageFormat</font> format) {<br />&nbsp;&nbsp;<font color="#408080">MemoryStream</font> stream = <font color="blue">new </font> <font color="#408080">MemoryStream</font>();<br />&nbsp;&nbsp;image.Save(stream, format);<br /><br />&nbsp;&nbsp;<font color="blue">byte</font>[] buffer = stream.GetBuffer();<br /><br />&nbsp;&nbsp;stream.Close();<br />&nbsp;&nbsp;stream = null;<br /><br />&nbsp;&nbsp;<font color="blue">return</font> buffer;<br />}<br /></font><br />or<br /><font face="courier"><br /><font color="blue">public static byte</font>[] ImageToByteArray(<font color="blue">string</font> image_file) {<br />&nbsp;&nbsp;<font color="#408080">FileStream</font> stream = <font color="blue">new</font> <font color="#408080">FileStream</font>(image_file, <font color="#408080">FileMode</font>.Open);<br />&nbsp;&nbsp;<font color="blue">int</font> size = (<font color="blue">int</font>)stream.Length;<br />&nbsp;&nbsp;<font color="blue">byte</font>[] buffer = <font color="blue">new byte</font>[size];<br />&nbsp;&nbsp;stream.Read(buffer, 0, size);<br /><br />&nbsp;&nbsp;<font color="blue">return</font> buffer;<br />}<br /></font><br />For loading image from the database to the application I simply convert the byte[] to an Image. I do that by:<br /><font face="courier"><br /><font color="blue">public static</font> <font color="#408080">Image</font> ByteArrayToImage(<font color="blue">byte</font>[] raw_data) {<br />&nbsp;&nbsp;<font color="#408080">MemoryStream</font> stream = <font color="blue">new</font> <font color="#408080">MemoryStream</font>(raw_data.Length);<br />&nbsp;&nbsp;stream.Write(raw_data, 0, raw_data.Length - 1);<br /><br />&nbsp;&nbsp;<font color="#408080">Bitmap</font> image = <font color="blue">new</font> <font color="#408080">Bitmap</font>(stream);<br /> <br />&nbsp;&nbsp;stream.Close();<br />&nbsp;&nbsp;stream = <font color="blue">null</font>;<br /><br />&nbsp;&nbsp;<font color="blue">return</font> image;<br />}<br /></font><br />Since each inspection report will contain around 40-50 observation, it can also take around 40-50 images. For synchronizing the application via web services, I had to split up the inspection report in parts, 1 part will contain all the textual information, and all the other parts will be for the photos. The Mobile Client Software Factory made life easier for having this architecture run on an occasionally connected environment.<br /><br />Other things that are keeping me busy is integrating mobile applications with popular out-of-the-box ERP systems, such as Navision, Axapta, and Visma. I'll post more info and how-to's once I get more familiar with these systems.