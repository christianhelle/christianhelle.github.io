---
layout: post
title: Writing a Puzzle Game for Windows Phone 7 using XNA
date: '2010-09-15T10:38:00.147+02:00'
author: Christian Resma Helle
tags:
- Windows Phone 7
- How to
- Step by Step
modified_time: '2010-09-27T13:29:20.157+02:00'
thumbnail: http://4.bp.blogspot.com/_kVNAYTvQ3QE/TJtLUfa1DqI/AAAAAAAACp4/3Zrdj2Wwv6I/s72-c/Create+New+Project.jpg
blogger_id: tag:blogger.com,1999:blog-4995334164049002857.post-4439275956730839714
blogger_orig_url: https://christian-helle.blogspot.com/2010/09/writing-puzzle-game-for-windows-phone-7.html
---

This article is a step by step guide on how to write a puzzle game for Windows Phone 7 using XNA. Before we get started you will need the <a href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=04704acf-a63a-4f97-952c-8b51b34b00ce">Windows Phone 7 Developer Tools</a>. Please note that I'm not really a game developer and I might not be doing the best practices. The intention of this article is just to demonstrate how easy it is to write a game using XNA even if one has little to no experience in game development.<br /><br />I've been playing around with XNA these past few nights and decided to write a few casual games. The first prototype I have is a port of my old Puzzle Game. The game is still really incomplete, like there is no menu or state management which means you can't shut it down properly and stuff. But I thought I'd share some thoughts on my experience with it and at the same time share some code.<br /><br />The structure of the game is fairly simple. I have 2 collections: one contains an image, another contains an index to the each of the elements of the first collection and its the area where to display the image on the screen. The collection that contains the indexes is my scrambled puzzle. Each time a piece is moved, I update the order of my scrambled list afterwards I check if all the items in my scrambled list are correctly sorted in an ascending fashion. If all the items are sorted properly then it means that the puzzle was solved.<br /><br />Enough said and let's get started. The first step is to of course fire up Visual Studio and create a new XNA Game Studio 4.0 - Windows Phone Game project. Let's call the project <span style="font-weight:bold;">PuzzleGame</span><br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_kVNAYTvQ3QE/TJtLUfa1DqI/AAAAAAAACp4/3Zrdj2Wwv6I/s1600/Create+New+Project.jpg"><img style="cursor:pointer; cursor:hand;" src="http://4.bp.blogspot.com/_kVNAYTvQ3QE/TJtLUfa1DqI/AAAAAAAACp4/3Zrdj2Wwv6I/s400/Create+New+Project.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5520088583676169890" /></a><br /><br />Now that we have a project we can start adding some <a href="http://msdn.microsoft.com/en-us/library/bb447756.aspx">content</a> or game assets. For this simple project, we will use 3 different game assets: the puzzle image, and 2 <a href="http://msdn.microsoft.com/en-us/library/bb447673.aspx">Sprite Font</a> for drawing the elapsed playing time and to draw text to congratulate the player once they complete the puzzle. To add content, right click on the PuzzleGameContent project, then click on Add.<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_kVNAYTvQ3QE/TJtZcivezHI/AAAAAAAACqA/TykBTqmWDTA/s1600/Add+Existing+Item.jpg"><img style="cursor:pointer; cursor:hand;width: 400px; height: 396px;" src="http://2.bp.blogspot.com/_kVNAYTvQ3QE/TJtZcivezHI/AAAAAAAACqA/TykBTqmWDTA/s400/Add+Existing+Item.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5520104115169840242" /></a><br /><br />For the puzzle image, we can pick up one of the sample pictures included in Windows 7 (e.g. \Users\Public\Pictures\Sample Pictures)<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_kVNAYTvQ3QE/TJtaDephfeI/AAAAAAAACqI/uWSd56n5XYU/s1600/Add+Existing+Item+-+Puzzle+Picture.jpg"><img style="cursor:pointer; cursor:hand;width: 400px; height: 242px;" src="http://4.bp.blogspot.com/_kVNAYTvQ3QE/TJtaDephfeI/AAAAAAAACqI/uWSd56n5XYU/s400/Add+Existing+Item+-+Puzzle+Picture.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5520104784086007266" /></a><br /><br />After adding the puzzle image we should change the Asset Name property to <span style="font-weight:bold;">PuzzleImage</span>. This can be done through the Properties Window (Right click on the added image in the Solution Explorer and click Properties)<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_kVNAYTvQ3QE/TJtbggI4cQI/AAAAAAAACqQ/UmKYUH-0Du8/s1600/PuzzleImage+Asset+Name.jpg"><img style="cursor:pointer; cursor:hand;width: 357px; height: 275px;" src="http://4.bp.blogspot.com/_kVNAYTvQ3QE/TJtbggI4cQI/AAAAAAAACqQ/UmKYUH-0Du8/s400/PuzzleImage+Asset+Name.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5520106382213804290" /></a><br /><br />To add Sprite Fonts, right click on the content project, click Add - New Item, then select Sprite Font. Let's add 2 sprite fonts and call them <span style="font-weight:bold;">GameTime </span>and <span style="font-weight:bold;">Congratulations</span><br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_kVNAYTvQ3QE/TJtsw1bVi-I/AAAAAAAACqk/hXJH2R0c0bg/s1600/Add+New+Item.jpg"><img style="cursor:pointer; cursor:hand;width: 400px; height: 389px;" src="http://2.bp.blogspot.com/_kVNAYTvQ3QE/TJtsw1bVi-I/AAAAAAAACqk/hXJH2R0c0bg/s400/Add+New+Item.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5520125354503932898" /></a><br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://3.bp.blogspot.com/_kVNAYTvQ3QE/TJyRhIr0BqI/AAAAAAAACq0/53B1sBn8OAA/s1600/Add+Sprite+Font+-+GameTime.jpg"><img style="cursor:pointer; cursor:hand;width: 400px; height: 227px;" src="http://3.bp.blogspot.com/_kVNAYTvQ3QE/TJyRhIr0BqI/AAAAAAAACq0/53B1sBn8OAA/s400/Add+Sprite+Font+-+GameTime.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5520447241702344354" /></a><br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://3.bp.blogspot.com/_kVNAYTvQ3QE/TJttrdIcliI/AAAAAAAACqs/rLfJ38qzR5w/s1600/Add+Sprite+Font+-+Congratulations.jpg"><img style="cursor:pointer; cursor:hand;width: 400px; height: 226px;" src="http://3.bp.blogspot.com/_kVNAYTvQ3QE/TJttrdIcliI/AAAAAAAACqs/rLfJ38qzR5w/s400/Add+Sprite+Font+-+Congratulations.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5520126361594533410" /></a><br /><br />Let's change the Asset Name of the Sprite Fonts we just added to <span style="font-weight:bold;">GameTimeFont</span> and <span style="font-weight:bold;">CongratulationsFont</span><br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://1.bp.blogspot.com/_kVNAYTvQ3QE/TJ8qF-aMsnI/AAAAAAAACq8/AeNDq6mC-C4/s1600/GameTime+Sprite+Font+Name.jpg"><img style="cursor:pointer; cursor:hand;width: 400px; height: 214px;" src="http://1.bp.blogspot.com/_kVNAYTvQ3QE/TJ8qF-aMsnI/AAAAAAAACq8/AeNDq6mC-C4/s400/GameTime+Sprite+Font+Name.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5521177950320112242" /></a><br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://3.bp.blogspot.com/_kVNAYTvQ3QE/TJ8qN6NGpDI/AAAAAAAACrE/8beoa2FZ8Ck/s1600/Congratulations+Sprite+Font+Name.jpg"><img style="cursor:pointer; cursor:hand;width: 400px; height: 214px;" src="http://3.bp.blogspot.com/_kVNAYTvQ3QE/TJ8qN6NGpDI/AAAAAAAACrE/8beoa2FZ8Ck/s400/Congratulations+Sprite+Font+Name.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5521178086630401074" /></a><br /><br />The SpriteFont content is actually just an XML file. The GameTime font's default description should be good enough but let's change the Congratulations font description to use a larger size. Open Congratulations.spritefont from the solution explorer and change the <span style="font-weight:bold;">Size</span> to 48, and change the <span style="font-weight:bold;">Style</span> to Bold<br /><br />Now that we have our game assets in place we can start coding. A lot of initial code is generated when creating a new XNA Game Studio project. To start things clean let's rename default Game1 class to PuzzleGame and delete all the contents leaving the PuzzleGame class empty. <br /><br />Before we start implementing our PuzzleGame class we'll need to create a class which will represent a piece of the puzzle, let's call this PuzzlePiece<br /><br /><div style="font-family: Courier New; font-size: 10pt; color: black; background: white;"><pre style="margin: 0px;"><span style="color: blue;">class</span> <span style="color: #2b91af;">PuzzlePiece</span></pre><pre style="margin: 0px;">{</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">public</span> <span style="color: blue;">int</span> Index { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">public</span> <span style="color: #2b91af;">Vector2</span> Bounds { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">public</span> <span style="color: blue;">override</span> <span style="color: blue;">int</span> GetHashCode()</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span> Index.GetHashCode();</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">public</span> <span style="color: blue;">override</span> <span style="color: blue;">bool</span> Equals(<span style="color: blue;">object</span> obj)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> piece = obj <span style="color: blue;">as</span> <span style="color: #2b91af;">PuzzlePiece</span>;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (piece != <span style="color: blue;">null</span>)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span> Index.Equals(piece.Index);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span> <span style="color: blue;">base</span>.Equals(obj);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">}</pre></div><br /><br />We'll also need an enumeration that describes the state of the game. This state describes what to draw on the screen. Let's call this enum DrawMode. There are 2 simple states of the game:<br /><br />1. Puzzle - Draws the puzzle game<br />2. Congratulations - Draws a "Congratulations" text once the player solves the puzzle<br /><br /><div style="font-family: Courier New; font-size: 10pt; color: black; background: white;"><pre style="margin: 0px;"><span style="color: blue;">enum</span> <span style="color: #2b91af;">DrawMode</span></pre><pre style="margin: 0px;">{</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; Puzzle,</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; Congratulations</pre><pre style="margin: 0px;">}</pre></div><br /><br />Now we can start implementing our PuzzleGame class. The first step is to define our global variables and the constructor method<br /><br /><div style="font-family: Courier New; font-size: 10pt; color: black; background: white;"><pre style="margin: 0px;"><span style="color: #2b91af;">GraphicsDeviceManager</span> graphics;</pre><pre style="margin: 0px;"><span style="color: #2b91af;">SpriteBatch</span> spriteBatch;</pre><pre style="margin: 0px;"><span style="color: #2b91af;">Texture2D</span> previewTexture;</pre><pre style="margin: 0px;"><span style="color: #2b91af;">Vector2</span> previewVector, emptyPiece, totalGameTimeVector, congratulationsVector;</pre><pre style="margin: 0px;"><span style="color: #2b91af;">SpriteFont</span> gameTimerFont,congratulationsFont;</pre><pre style="margin: 0px;"><span style="color: #2b91af;">Dictionary</span>&lt;<span style="color: blue;">int</span>, <span style="color: #2b91af;">Texture2D</span>&gt; puzzlePieces;</pre><pre style="margin: 0px;"><span style="color: #2b91af;">Dictionary</span>&lt;<span style="color: blue;">int</span>, <span style="color: #2b91af;">PuzzlePiece</span>&gt; scrambledPieces;</pre><pre style="margin: 0px;"><span style="color: #2b91af;">DrawMode</span> Mode;</pre><pre style="margin: 0px;"><span style="color: blue;">int</span> height, width;</pre><pre style="margin: 0px;"><span style="color: blue;">double</span> elapsedTime, playingTime;</pre><pre style="margin: 0px;"><span style="color: #2b91af;">Queue</span>&lt;<span style="color: #2b91af;">Keys</span>&gt; pendingCommands;</pre><pre style="margin: 0px;"><span style="color: blue;">const</span> <span style="color: blue;">int</span> PIECE_COUNT = 4 * 4;</pre><pre style="margin: 0px;"><span style="color: blue;">bool</span> solved;</pre><pre style="margin: 0px;"><span style="color: blue;">static</span> <span style="color: blue;">bool</span> animating;</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;"><span style="color: blue;">public</span> PuzzleGame()</pre><pre style="margin: 0px;">{</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; graphics = <span style="color: blue;">new</span> <span style="color: #2b91af;">GraphicsDeviceManager</span>(<span style="color: blue;">this</span>);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; Content.RootDirectory = <span style="color: #a31515;">&quot;Content&quot;</span>;</pre><pre style="margin: 0px;">}</pre></div><br /><br />Next step is to implement the <a href="http://msdn.microsoft.com/en-us/library/microsoft.xna.framework.game.initialize.aspx">Initialize()</a> method. This method allows the game to perform any initialization it needs before it starts to run. With a simple game such as this one could debate where to put the initialization code, I could easily see myself having my initialize code in the constructor method. To make this example as XNA'ish let's initialize our non-content variables in the <a href="http://msdn.microsoft.com/en-us/library/microsoft.xna.framework.game.initialize.aspx">Initialize()</a> method.<br /><br /><div style="font-family: Courier New; font-size: 10pt; color: black; background: white;"><pre style="margin: 0px;"><span style="color: gray;">///</span><span style="color: green;"> </span><span style="color: gray;">&lt;summary&gt;</span></pre><pre style="margin: 0px;"><span style="color: gray;">///</span><span style="color: green;"> Allows the game to perform any initialization it needs to before starting to run.</span></pre><pre style="margin: 0px;"><span style="color: gray;">///</span><span style="color: green;"> This is where it can query for any required services and load any non-graphic</span></pre><pre style="margin: 0px;"><span style="color: gray;">///</span><span style="color: green;"> related content.&nbsp; Calling base.Initialize will enumerate through any components</span></pre><pre style="margin: 0px;"><span style="color: gray;">///</span><span style="color: green;"> and initialize them as well.</span></pre><pre style="margin: 0px;"><span style="color: gray;">///</span><span style="color: green;"> </span><span style="color: gray;">&lt;/summary&gt;</span></pre><pre style="margin: 0px;"><span style="color: blue;">protected</span> <span style="color: blue;">override</span> <span style="color: blue;">void</span> Initialize()</pre><pre style="margin: 0px;">{</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; pendingCommands = <span style="color: blue;">new</span> <span style="color: #2b91af;">Queue</span>&lt;<span style="color: #2b91af;">Keys</span>&gt;();</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; Mode = <span style="color: #2b91af;">DrawMode</span>.Puzzle;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; previewVector = <span style="color: blue;">new</span> <span style="color: #2b91af;">Vector2</span>(0, 0);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; totalGameTimeVector = <span style="color: blue;">new</span> <span style="color: #2b91af;">Vector2</span>(10, 10);</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">base</span>.Initialize();</pre><pre style="margin: 0px;">}</pre></div><br /><br />Next we implement the <a href="http://msdn.microsoft.com/en-us/library/microsoft.xna.framework.game.loadcontent.aspx">LoadContent</a>() and <a href="http://msdn.microsoft.com/en-us/library/microsoft.xna.framework.game.unloadcontent.aspx">UnloadContent</a>()<br /><br /><div style="font-family: Courier New; font-size: 10pt; color: black; background: white;"><pre style="margin: 0px;"><span style="color: gray;">///</span><span style="color: green;"> </span><span style="color: gray;">&lt;summary&gt;</span></pre><pre style="margin: 0px;"><span style="color: gray;">///</span><span style="color: green;"> LoadContent will be called once per game and is the place to load</span></pre><pre style="margin: 0px;"><span style="color: gray;">///</span><span style="color: green;"> all of your content.</span></pre><pre style="margin: 0px;"><span style="color: gray;">///</span><span style="color: green;"> </span><span style="color: gray;">&lt;/summary&gt;</span></pre><pre style="margin: 0px;"><span style="color: blue;">protected</span> <span style="color: blue;">override</span> <span style="color: blue;">void</span> LoadContent()</pre><pre style="margin: 0px;">{</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; spriteBatch = <span style="color: blue;">new</span> <span style="color: #2b91af;">SpriteBatch</span>(GraphicsDevice);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; previewTexture = Content.Load&lt;<span style="color: #2b91af;">Texture2D</span>&gt;(<span style="color: #a31515;">&quot;PuzzleImage&quot;</span>);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; gameTimerFont = Content.Load&lt;<span style="color: #2b91af;">SpriteFont</span>&gt;(<span style="color: #a31515;">&quot;GameTimeFont&quot;</span>);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; congratulationsFont = Content.Load&lt;<span style="color: #2b91af;">SpriteFont</span>&gt;(<span style="color: #a31515;">&quot;CongratulationsFont&quot;</span>);</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> size = congratulationsFont.MeasureString(<span style="color: #a31515;">&quot;Congrautulations!&quot;</span>);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; congratulationsVector = <span style="color: blue;">new</span> <span style="color: #2b91af;">Vector2</span>(</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; (GraphicsDevice.Viewport.Width - size.X) / 2,</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; (GraphicsDevice.Viewport.Height - size.Y) / 2);</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; Divide();</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; Scramble();</pre><pre style="margin: 0px;">}</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;"><span style="color: gray;">///</span><span style="color: green;"> </span><span style="color: gray;">&lt;summary&gt;</span></pre><pre style="margin: 0px;"><span style="color: gray;">///</span><span style="color: green;"> UnloadContent will be called once per game and is the place to unload</span></pre><pre style="margin: 0px;"><span style="color: gray;">///</span><span style="color: green;"> all content.</span></pre><pre style="margin: 0px;"><span style="color: gray;">///</span><span style="color: green;"> </span><span style="color: gray;">&lt;/summary&gt;</span></pre><pre style="margin: 0px;"><span style="color: blue;">protected</span> <span style="color: blue;">override</span> <span style="color: blue;">void</span> UnloadContent()</pre><pre style="margin: 0px;">{</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; previewTexture.Dispose();</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">foreach</span> (<span style="color: blue;">var</span> item <span style="color: blue;">in</span> puzzlePieces)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; item.Value.Dispose();</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; spriteBatch.Dispose();</pre><pre style="margin: 0px;">}</pre></div><br /><br />You probably noticed that LoadContent calls methods called <span style="font-weight:bold;">Divide</span>() and <span style="font-weight:bold;">Scramble</span>(). <br /><br />The <span style="font-weight:bold;">Divide</span>() method splits the puzzle image into tiny pieces represented by the PuzzlePiece class. The full puzzle image is stored in a <a href="http://msdn.microsoft.com/en-us/library/microsoft.xna.framework.graphics.texture2d.aspx">Texture2D</a> object called previewTexture, to split this into pieces I copy the color information of the puzzle image within a specified bounds into an array of type Color and then I set this color information in a new instance of Texture2D.<br /><br /><div style="font-family: Courier New; font-size: 10pt; color: black; background: white;"><pre style="margin: 0px;"><span style="color: blue;">private</span> <span style="color: blue;">void</span> Divide()</pre><pre style="margin: 0px;">{</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> idx = 0;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> cells = <span style="color: #2b91af;">Convert</span>.ToInt32(<span style="color: #2b91af;">Math</span>.Sqrt(PIECE_COUNT));</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; height = GraphicsDevice.Viewport.Height / cells;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; width = GraphicsDevice.Viewport.Width / cells;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; puzzlePieces = <span style="color: blue;">new</span> <span style="color: #2b91af;">Dictionary</span>&lt;<span style="color: blue;">int</span>, <span style="color: #2b91af;">Texture2D</span>&gt;();</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">for</span> (<span style="color: blue;">int</span> y = 0; y &lt; GraphicsDevice.Viewport.Height; y += height)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">for</span> (<span style="color: blue;">int</span> x = 0; x &lt; GraphicsDevice.Viewport.Width; x += width)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> rectangle = <span style="color: blue;">new</span> <span style="color: #2b91af;">Rectangle</span>(x, y, width, height);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> data = <span style="color: blue;">new</span> <span style="color: #2b91af;">Color</span>[width * height];</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; previewTexture.GetData&lt;<span style="color: #2b91af;">Color</span>&gt;(0, rectangle, data, 0, data.Length);</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> piece = <span style="color: blue;">new</span> <span style="color: #2b91af;">Texture2D</span>(GraphicsDevice, width, height);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; piece.SetData(data);</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; puzzlePieces.Add(idx++, piece);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">}</pre></div><br /><br />The <span style="font-weight:bold;">Scramble</span>() method does exactly what the method name describes, it scrambles the puzzle. The field called <span style="font-weight:bold;">scrambledPieces</span> is a key/value pair collection that uses the index of the <span style="font-weight:bold;">puzzlePieces</span> collection as the key and the bounds of this image to be drawn on the screen as the value. The bounds of the image is stored in a <a href="http://msdn.microsoft.com/en-us/library/microsoft.xna.framework.vector2.aspx">Vector2</a> object.<br /><br /><div style="font-family: Courier New; font-size: 10pt; color: black; background: white;"><pre style="margin: 0px;"><span style="color: blue;">private</span> <span style="color: blue;">void</span> Scramble()</pre><pre style="margin: 0px;">{</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> idx = 0;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> random = <span style="color: blue;">new</span> <span style="color: #2b91af;">Random</span>();</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> capacity = puzzlePieces.Count - 1;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; scrambledPieces = <span style="color: blue;">new</span> <span style="color: #2b91af;">Dictionary</span>&lt;<span style="color: blue;">int</span>, <span style="color: #2b91af;">PuzzlePiece</span>&gt;(puzzlePieces.Count);</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">for</span> (<span style="color: blue;">int</span> y = 0; y &lt; GraphicsDevice.Viewport.Height; y += height)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">for</span> (<span style="color: blue;">int</span> x = 0; x &lt; GraphicsDevice.Viewport.Width; x += width)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (idx &lt; capacity)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> piece = <span style="color: blue;">new</span> <span style="color: #2b91af;">PuzzlePiece</span>();</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">while</span> (<span style="color: blue;">true</span>)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; piece.Index = random.Next(0, capacity);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (!scrambledPieces.ContainsValue(piece))</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">break</span>;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; piece.Bounds = <span style="color: blue;">new</span> <span style="color: #2b91af;">Vector2</span>(x, y);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; scrambledPieces.Add(idx++, piece);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">else</span></pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; emptyPiece = <span style="color: blue;">new</span> <span style="color: #2b91af;">Vector2</span>(x, y);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; scrambledPieces.Add(idx, <span style="color: blue;">new</span> <span style="color: #2b91af;">PuzzlePiece</span> { Index = -1 });</pre><pre style="margin: 0px;">}</pre></div><br /><br />All we need now is to implement the <a href="http://msdn.microsoft.com/en-us/library/bb203873.aspx">Game Loop</a>.<br /><br />The <a href="http://msdn.microsoft.com/en-us/library/microsoft.xna.framework.game.update.aspx">Update</a>() method will contain the game logic. The game logic will be used for updating the game surface, collision detection, accepting and handling user input, background music, sounds effects, etc. In our game we use it for accepting and handling user input. We accept the user input through polling the Mouse state by calling the static method<a href="http://msdn.microsoft.com/en-us/library/microsoft.xna.framework.input.mouse.getstate.aspx"> Mouse.GetState()</a>. We handle the user input by doing a hit test to get which puzzle piece was clicked and moving this piece. Only one piece can be moved at a time and this piece can only move up, down, left, or right. For those who are not familiar with what a hit test is, here's my attempt to define it: A hit test is a way of detecting if 2 objects are touching or intersecting with each other. In our case, we use hit testing to figure out which puzzle piece was clicked by checking all the pieces of the puzzle if the mouse position is inside its bounds. Moving a puzzle piece is implemented as a very basic animation that runs on a separate thread. User input is not handled while the puzzle pieces are being moved around. The update method also updates the game playing time which we later on draw on the screen.<br /><br /><div style="font-family: Courier New; font-size: 10pt; color: black; background: white;"><pre style="margin: 0px;"><span style="color: gray;">///</span><span style="color: green;"> </span><span style="color: gray;">&lt;summary&gt;</span></pre><pre style="margin: 0px;"><span style="color: gray;">///</span><span style="color: green;"> Allows the game to run logic such as updating the world,</span></pre><pre style="margin: 0px;"><span style="color: gray;">///</span><span style="color: green;"> checking for collisions, gathering input, and playing audio.</span></pre><pre style="margin: 0px;"><span style="color: gray;">///</span><span style="color: green;"> </span><span style="color: gray;">&lt;/summary&gt;</span></pre><pre style="margin: 0px;"><span style="color: gray;">///</span><span style="color: green;"> </span><span style="color: gray;">&lt;param name=&quot;gameTime&quot;&gt;</span><span style="color: green;">Provides a snapshot of timing values.</span><span style="color: gray;">&lt;/param&gt;</span></pre><pre style="margin: 0px;"><span style="color: blue;">protected</span> <span style="color: blue;">override</span> <span style="color: blue;">void</span> Update(<span style="color: #2b91af;">GameTime</span> gameTime)</pre><pre style="margin: 0px;">{</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> mouseState = <span style="color: #2b91af;">Mouse</span>.GetState();</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (mouseState.LeftButton == <span style="color: #2b91af;">ButtonState</span>.Pressed)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (animating)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">base</span>.Update(gameTime);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span>;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> clickedRectangle = <span style="color: blue;">new</span> <span style="color: #2b91af;">Rectangle</span>(mouseState.X, mouseState.Y, width, height);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> pieceRect = <span style="color: blue;">new</span> <span style="color: #2b91af;">Rectangle</span>(0, 0, width, height);</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">for</span> (<span style="color: blue;">int</span> i = 0; i &lt; scrambledPieces.Count; i++)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; pieceRect.X = (<span style="color: blue;">int</span>)scrambledPieces[i].Bounds.X;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; pieceRect.Y = (<span style="color: blue;">int</span>)scrambledPieces[i].Bounds.Y;</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (!pieceRect.Intersects(clickedRectangle))</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">continue</span>;</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (mouseState.X &gt;= emptyPiece.X &amp;&amp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; mouseState.X &lt;= emptyPiece.X + width &amp;&amp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; mouseState.Y &gt;= emptyPiece.Y &amp;&amp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; mouseState.Y &lt;= emptyPiece.Y + height)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">continue</span>;</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">Keys</span> command = <span style="color: #2b91af;">Keys</span>.None;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (pieceRect.X &gt;= emptyPiece.X &amp;&amp; pieceRect.X &lt;= emptyPiece.X)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (pieceRect.Y - height == emptyPiece.Y)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; command = <span style="color: #2b91af;">Keys</span>.Up;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">else</span> <span style="color: blue;">if</span> (pieceRect.Y + height == emptyPiece.Y)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; command = <span style="color: #2b91af;">Keys</span>.Down;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">else</span> <span style="color: blue;">if</span> (pieceRect.Y &gt;= emptyPiece.Y &amp;&amp; pieceRect.Y &lt;= emptyPiece.Y)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (pieceRect.X - width == emptyPiece.X)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; command = <span style="color: #2b91af;">Keys</span>.Left;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">else</span> <span style="color: blue;">if</span> (pieceRect.X + width == emptyPiece.X)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; command = <span style="color: #2b91af;">Keys</span>.Right;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (command != <span style="color: #2b91af;">Keys</span>.None &amp;&amp; !pendingCommands.Contains(command))</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; pendingCommands.Enqueue(command);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">Debug</span>.WriteLine(<span style="color: #a31515;">&quot;Clicked: &quot;</span> + i);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">break</span>;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">else</span></pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; elapsedTime += gameTime.ElapsedGameTime.TotalMilliseconds;</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (elapsedTime &gt;= 10)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (pendingCommands.Count &gt; 0)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; MovePiece(pendingCommands.Dequeue());</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; elapsedTime = 0;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (!solved)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; playingTime += gameTime.ElapsedGameTime.TotalMilliseconds;</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">base</span>.Update(gameTime);</pre><pre style="margin: 0px;">}</pre></div><br /><br />The MovePiece() method does a hit test to find which piece to move. Once the correct piece is found the Animate() method is called. <br /><br /><div style="font-family: Courier New; font-size: 10pt; color: black; background: white;"><pre style="margin: 0px;"><span style="color: blue;">private</span> <span style="color: blue;">void</span> MovePiece(<span style="color: #2b91af;">Keys</span> command)</pre><pre style="margin: 0px;">{</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">for</span> (<span style="color: blue;">int</span> i = 0; i &lt; scrambledPieces.Count; i++)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">switch</span> (command)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">case</span> <span style="color: #2b91af;">Keys</span>.Up:</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (scrambledPieces[i].Bounds.X == emptyPiece.X &amp;&amp; scrambledPieces[i].Bounds.Y - height == emptyPiece.Y)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Animate(command, i);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span>;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">break</span>;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">case</span> <span style="color: #2b91af;">Keys</span>.Down:</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (scrambledPieces[i].Bounds.X == emptyPiece.X &amp;&amp; scrambledPieces[i].Bounds.Y + height == emptyPiece.Y)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Animate(command, i);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span>;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">break</span>;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">case</span> <span style="color: #2b91af;">Keys</span>.Left:</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (scrambledPieces[i].Bounds.Y == emptyPiece.Y &amp;&amp; scrambledPieces[i].Bounds.X - width == emptyPiece.X)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Animate(command, i);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span>;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">break</span>;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">case</span> <span style="color: #2b91af;">Keys</span>.Right:</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (scrambledPieces[i].Bounds.Y == emptyPiece.Y &amp;&amp; scrambledPieces[i].Bounds.X + width == emptyPiece.X)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Animate(command, i);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span>;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">break</span>;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">}</pre></div><br /><br />The Animate() method starts a thread in the ThreadPool which will move the puzzle piece by 2 pixels at a time until the piece is placed in the empty area. The empty area information is stored in the <span style="font-weight:bold;">emptyPiece</span> object. Once the piece is in the empty area the scrambled index of the piece is updated together with its new bounds. Finally a check if the puzzle was solved by the move is done.<br /><br /><div style="font-family: Courier New; font-size: 10pt; color: black; background: white;"><pre style="margin: 0px;"><span style="color: blue;">private</span> <span style="color: blue;">void</span> Animate(<span style="color: #2b91af;">Keys</span> direction, <span style="color: blue;">int</span> i)</pre><pre style="margin: 0px;">{</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; animating = <span style="color: blue;">true</span>;</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">ThreadPool</span>.QueueUserWorkItem((state) =&gt;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">try</span></pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">const</span> <span style="color: blue;">int</span> INCREMENT = 2;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> newEmptyPiece = scrambledPieces[i].Bounds;</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">while</span> (scrambledPieces[i].Bounds != emptyPiece)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">switch</span> (direction)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">case</span> <span style="color: #2b91af;">Keys</span>.Up:</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; scrambledPieces[i].Bounds = <span style="color: blue;">new</span> <span style="color: #2b91af;">Vector2</span>(emptyPiece.X, scrambledPieces[i].Bounds.Y - INCREMENT);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">break</span>;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">case</span> <span style="color: #2b91af;">Keys</span>.Down:</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; scrambledPieces[i].Bounds = <span style="color: blue;">new</span> <span style="color: #2b91af;">Vector2</span>(emptyPiece.X, scrambledPieces[i].Bounds.Y + INCREMENT);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">break</span>;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">case</span> <span style="color: #2b91af;">Keys</span>.Left:</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; scrambledPieces[i].Bounds = <span style="color: blue;">new</span> <span style="color: #2b91af;">Vector2</span>(scrambledPieces[i].Bounds.X - INCREMENT, emptyPiece.Y);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">break</span>;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">case</span> <span style="color: #2b91af;">Keys</span>.Right:</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; scrambledPieces[i].Bounds = <span style="color: blue;">new</span> <span style="color: #2b91af;">Vector2</span>(scrambledPieces[i].Bounds.X + INCREMENT, emptyPiece.Y);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">break</span>;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">Thread</span>.Sleep(1);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; emptyPiece = newEmptyPiece;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">finally</span></pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; UpdateScrambledIndex(direction, i);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; CheckForCompletion();</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; animating = <span style="color: blue;">false</span>;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; });</pre><pre style="margin: 0px;">}</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;"><span style="color: blue;">private</span> <span style="color: blue;">void</span> UpdateScrambledIndex(<span style="color: #2b91af;">Keys</span> command, <span style="color: blue;">int</span> index)</pre><pre style="margin: 0px;">{</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> newIndex = -1;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> INCREMENT = <span style="color: #2b91af;">Convert</span>.ToInt32(<span style="color: #2b91af;">Math</span>.Sqrt(PIECE_COUNT));</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">switch</span> (command)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">case</span> <span style="color: #2b91af;">Keys</span>.Up:</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; newIndex = index - INCREMENT;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (newIndex &lt; 0) newIndex = 0;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">break</span>;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">case</span> <span style="color: #2b91af;">Keys</span>.Down:</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; newIndex = index + INCREMENT;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (newIndex &gt; scrambledPieces.Count - 1) newIndex = scrambledPieces.Count - 1;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">break</span>;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">case</span> <span style="color: #2b91af;">Keys</span>.Left:</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; newIndex = index - 1;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (newIndex &lt; 0) newIndex = 0;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">break</span>;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">case</span> <span style="color: #2b91af;">Keys</span>.Right:</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; newIndex = index + 1;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (newIndex &gt; scrambledPieces.Count - 1) newIndex = scrambledPieces.Count - 1;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">break</span>;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> temp = scrambledPieces[newIndex];</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; scrambledPieces[newIndex] = scrambledPieces[index];</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; scrambledPieces[index] = temp;</pre><pre style="margin: 0px;">}</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;"><span style="color: blue;">private</span> <span style="color: blue;">void</span> CheckForCompletion()</pre><pre style="margin: 0px;">{</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">for</span> (<span style="color: blue;">int</span> i = 0; i &lt; scrambledPieces.Count - 1; i++)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (scrambledPieces[i].Index != i)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span>;</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; solved = <span style="color: blue;">true</span>;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; Mode = <span style="color: #2b91af;">DrawMode</span>.Congratulations;</pre><pre style="margin: 0px;">}</pre></div><br /><br />Last but not the least we implement the <a href="http://msdn.microsoft.com/en-us/library/microsoft.xna.framework.game.draw.aspx">Draw</a>() method. This is where we render the screen. We always start by clearing the screen and afterwards adding sprites to our <a href="http://msdn.microsoft.com/en-us/library/microsoft.xna.framework.graphics.spritebatch.aspx">SpriteBatch</a>. In our game we only have 2 ways of rendering the screen: rendering the puzzle game in play; and rendering if the puzzle was solved. <br /><br />To render the puzzle game I add a sprite that draws the game playing time on the top left corner then I add a sprite for each piece of the puzzle by iterating through my scrambledPieces collection..<br /><br />To render the screen when the puzzle is solved I draw 2 sprites. One is the playing time and the other is "Congratulations"<br /><br /><div style="font-family: Courier New; font-size: 10pt; color: black; background: white;"><pre style="margin: 0px;"><span style="color: gray;">///</span><span style="color: green;"> </span><span style="color: gray;">&lt;summary&gt;</span></pre><pre style="margin: 0px;"><span style="color: gray;">///</span><span style="color: green;"> This is called when the game should draw itself.</span></pre><pre style="margin: 0px;"><span style="color: gray;">///</span><span style="color: green;"> </span><span style="color: gray;">&lt;/summary&gt;</span></pre><pre style="margin: 0px;"><span style="color: gray;">///</span><span style="color: green;"> </span><span style="color: gray;">&lt;param name=&quot;gameTime&quot;&gt;</span><span style="color: green;">Provides a snapshot of timing values.</span><span style="color: gray;">&lt;/param&gt;</span></pre><pre style="margin: 0px;"><span style="color: blue;">protected</span> <span style="color: blue;">override</span> <span style="color: blue;">void</span> Draw(<span style="color: #2b91af;">GameTime</span> gameTime)</pre><pre style="margin: 0px;">{</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; GraphicsDevice.Clear(<span style="color: #2b91af;">Color</span>.Black);</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; spriteBatch.Begin(<span style="color: #2b91af;">SpriteSortMode</span>.BackToFront, <span style="color: #2b91af;">BlendState</span>.AlphaBlend);</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">switch</span> (Mode)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">case</span> <span style="color: #2b91af;">DrawMode</span>.Puzzle:</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; spriteBatch.DrawString(gameTimerFont, <span style="color: blue;">new</span> <span style="color: #2b91af;">TimeSpan</span>(0, 0, 0, 0, (<span style="color: blue;">int</span>)playingTime).ToString(), totalGameTimeVector, <span style="color: #2b91af;">Color</span>.White);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">for</span> (<span style="color: blue;">int</span> i = 0; i &lt; scrambledPieces.Count; i++)</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (scrambledPieces[i].Index == -1) <span style="color: blue;">continue</span>;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> piece = puzzlePieces[scrambledPieces[i].Index];</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; spriteBatch.Draw(piece, scrambledPieces[i].Bounds, <span style="color: #2b91af;">Color</span>.White);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">break</span>;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">case</span> <span style="color: #2b91af;">DrawMode</span>.Congratulations:</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; spriteBatch.DrawString(gameTimerFont, <span style="color: blue;">new</span> <span style="color: #2b91af;">TimeSpan</span>(0, 0, 0, 0, (<span style="color: blue;">int</span>)playingTime).ToString(), totalGameTimeVector, <span style="color: #2b91af;">Color</span>.White);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; spriteBatch.DrawString(congratulationsFont, <span style="color: #a31515;">&quot;Congratulations!&quot;</span>, congratulationsVector, <span style="color: #2b91af;">Color</span>.White);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">break</span>;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; spriteBatch.End();</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">base</span>.Draw(gameTime);</pre><pre style="margin: 0px;">}</pre></div><br /><br />I hope you found this article useful and educational. You can grab the source code <a href="http://cid-ca531e7fb4762c70.office.live.com/self.aspx/Code%20Samples/PuzzleGameWP7.zip">here</a>