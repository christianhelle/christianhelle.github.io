---
layout: post
title: How to draw a rounded rectangle in .NETCF
date: '2010-01-25T22:29:00.035+01:00'
author: Christian Resma Helle
tags:
- Graphics
- How to
- ".NET Compact Framework"
modified_time: '2010-01-25T23:25:45.390+01:00'
blogger_id: tag:blogger.com,1999:blog-4995334164049002857.post-5297336445844260040
blogger_orig_url: https://christian-helle.blogspot.com/2010/01/how-to-draw-rounded-rectangle-in-netcf.html
---

In this short article I'd like to demonstrate how to draw rounded rectangles by P/Invoking the GDI function <a href="http://msdn.microsoft.com/en-us/library/aa929212.aspx">RoundRect</a>. Let's create an extension method called FillRoundedRectangle to the Graphics class.<br /><br />In order to use the function we need to create a few GDI objects: a Pen to draw the border, and a Brush to fill the rectangle. We will mostly use P/Invoke for creating and releasing GDI objects<br /><br /><div style="font-family: Fixedsys; font-size: 10pt; color: black; background: white;"><pre style="margin: 0px;"><span style="color: blue;">const</span> <span style="color: blue;">int</span> PS_SOLID = 0;</pre><pre style="margin: 0px;"><span style="color: blue;">const</span> <span style="color: blue;">int</span> PS_DASH = 1;</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">[<span style="color: #2b91af;">DllImport</span>(<span style="color: #a31515;">&quot;coredll.dll&quot;</span>)]</pre><pre style="margin: 0px;"><span style="color: blue;">static</span> <span style="color: blue;">extern</span> <span style="color: #2b91af;">IntPtr</span> CreatePen(<span style="color: blue;">int</span> fnPenStyle, <span style="color: blue;">int</span> nWidth, <span style="color: blue;">uint</span> crColor);</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">[<span style="color: #2b91af;">DllImport</span>(<span style="color: #a31515;">&quot;coredll.dll&quot;</span>)]</pre><pre style="margin: 0px;"><span style="color: blue;">static</span> <span style="color: blue;">extern</span> <span style="color: blue;">int</span> SetBrushOrgEx(<span style="color: #2b91af;">IntPtr</span> hdc, <span style="color: blue;">int</span> nXOrg, <span style="color: blue;">int</span> nYOrg, <span style="color: blue;">ref</span> <span style="color: #2b91af;">Point</span> lppt);</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">[<span style="color: #2b91af;">DllImport</span>(<span style="color: #a31515;">&quot;coredll.dll&quot;</span>)]</pre><pre style="margin: 0px;"><span style="color: blue;">static</span> <span style="color: blue;">extern</span> <span style="color: #2b91af;">IntPtr</span> CreateSolidBrush(<span style="color: blue;">uint</span> color);</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">[<span style="color: #2b91af;">DllImport</span>(<span style="color: #a31515;">&quot;coredll.dll&quot;</span>)]</pre><pre style="margin: 0px;"><span style="color: blue;">static</span> <span style="color: blue;">extern</span> <span style="color: #2b91af;">IntPtr</span> SelectObject(<span style="color: #2b91af;">IntPtr</span> hdc, <span style="color: #2b91af;">IntPtr</span> hgdiobject);</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">[<span style="color: #2b91af;">DllImport</span>(<span style="color: #a31515;">&quot;coredll.dll&quot;</span>)]</pre><pre style="margin: 0px;"><span style="color: blue;">static</span> <span style="color: blue;">extern</span> <span style="color: blue;">bool</span> DeleteObject(<span style="color: #2b91af;">IntPtr</span> hgdiobject);</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">[<span style="color: #2b91af;">DllImport</span>(<span style="color: #a31515;">&quot;coredll.dll&quot;</span>)]</pre><pre style="margin: 0px;"><span style="color: blue;">static</span> <span style="color: blue;">extern</span> <span style="color: blue;">bool</span> RoundRect(</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">IntPtr</span> hdc, </pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> nLeftRect, </pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> nTopRect, </pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> nRightRect, </pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> nBottomRect, </pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> nWidth, </pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> nHeight);</pre></div><br />The CreateSolidBrush function in native code actually takes a <a href="http://msdn.microsoft.com/en-us/library/aa923096.aspx">COLORREF</a> parameter, and the developer would normally use the <a href="http://msdn.microsoft.com/en-us/library/aa927387.aspx">RGB</a> macro to create it. We need to translate that macro into a .NET function<br /><br /><div style="font-family: Fixedsys; font-size: 10pt; color: black; background: white;"><pre style="margin: 0px;"><span style="color: blue;">static</span> <span style="color: blue;">uint</span> GetColorRef(<span style="color: #2b91af;">Color</span> value)</pre><pre style="margin: 0px;">{</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span> 0x00000000 | ((<span style="color: blue;">uint</span>)value.B &lt;&lt; 16) | ((<span style="color: blue;">uint</span>)value.G &lt;&lt; 8) | (<span style="color: blue;">uint</span>)value.R;</pre><pre style="margin: 0px;">}</pre></div><br />Now we have our P/Invoke definitions in place we can neatly wrap all P/Invoke operations in a single function and let's call that FillRoundedRectangle()<br /><br /><div style="font-family: Fixedsys; font-size: 10pt; color: black; background: white;"><pre style="margin: 0px;"><span style="color: blue;">public</span> <span style="color: blue;">static</span> <span style="color: blue;">void</span> FillRoundedRectangle(</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">this</span> <span style="color: #2b91af;">Graphics</span> graphics,</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">Pen</span> border,</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">Color</span> color,</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">Rectangle</span> rectangle,</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">Size</span> ellipseSize)</pre><pre style="margin: 0px;">{</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> lppt = <span style="color: blue;">new</span> <span style="color: #2b91af;">Point</span>();</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> hdc = graphics.GetHdc();</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> style = border.DashStyle == <span style="color: #2b91af;">DashStyle</span>.Solid ? PS_SOLID : PS_DASH;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> hpen = CreatePen(style, (<span style="color: blue;">int</span>)border.Width, GetColorRef(border.Color));</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> hbrush = CreateSolidBrush(GetColorRef(color));</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">try</span></pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; SetBrushOrgEx(hdc, rectangle.Left, rectangle.Top, <span style="color: blue;">ref</span> lppt);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; SelectObject(hdc, hpen);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; SelectObject(hdc, hbrush);</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; RoundRect(hdc, </pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; rectangle.Left, </pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; rectangle.Top, </pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; rectangle.Right, </pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; rectangle.Bottom, </pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; ellipseSize.Width, </pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; ellipseSize.Height);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">finally</span></pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; {</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; SetBrushOrgEx(hdc, lppt.Y, lppt.X, <span style="color: blue;">ref</span> lppt);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; DeleteObject(hpen);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; DeleteObject(hbrush);</pre><pre style="margin: 0px;">&nbsp;</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; graphics.ReleaseHdc(hdc);</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; }</pre><pre style="margin: 0px;">}</pre></div><br />Using this extension method should be straight forward, but here's an example where "e" is an instance of PaintEventArgs:<br /><br /><div style="font-family: Fixedsys; font-size: 10pt; color: black; background: white;"><pre style="margin: 0px;"><span style="color: blue;">using</span> (<span style="color: blue;">var</span> pen = <span style="color: blue;">new</span> <span style="color: #2b91af;">Pen</span>(<span style="color: #2b91af;">Color</span>.Blue))</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; e.Graphics.FillRoundedRectangle(</pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; pen, </pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">Color</span>.LightBlue, </pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">new</span> <span style="color: #2b91af;">Rectangle</span>(10, 10, 100, 100), </pre><pre style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">new</span> <span style="color: #2b91af;">Size</span>(16, 16));</pre></div><br /><br />I hope you found this useful. If you're interested in the full source code then you can grab it <a href="http://cid-ca531e7fb4762c70.skydrive.live.com/self.aspx/Code%20Samples/RoundedRectangle.cs">here</a>