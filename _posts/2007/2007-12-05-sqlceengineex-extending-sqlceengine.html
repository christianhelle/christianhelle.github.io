---
layout: post
title: SqlCeEngineEx - Extending the SqlCeEngine class
date: '2007-12-05T20:33:00.000+01:00'
# author: Christian Resma Helle
tags:
- SQL Server Compact Edition
- ".NET Compact Framework"
modified_time: '2008-01-07T09:37:10.267+01:00'
blogger_id: tag:blogger.com,1999:blog-4995334164049002857.post-8343075279084074763
blogger_orig_url: https://christian-helle.blogspot.com/2007/12/sqlceengineex-extending-sqlceengine.html
---

I use <font face="courier">System.Data.SqlServer.SqlCeEngine()</font> quite a lot in all my projects. I normally create the database on the fly when the application is launched for the first time and then I populate the initial data via a web service.<br /><br />I often check if database objects exist before I create them. You can do this by querying the INFORMATION_SCHEMA views. I created a helper class called SqlCeEngineEx that contains the following methods for querying the INFORMATION_SCHEMA:<br /><br />1) bool DoesTableExist(string table) - Checks if a table exists in the database<br />2) string[] GetTables() - Returns a string array of all the tables in the database<br />3) string[] GetTableConstraints(string table) - Returns a string array of all the constraints for a table<br />4) string[] GetTableConstraints() - Returns a string array of all the constraints in the database<br /><br />And here is the full code:<br /><font face="courier"><br /><font color="blue">public class</font> <font color="#408080">SqlCeEngineEx</font> : <font color="#408080">IDisposable</font><br />{<br />&nbsp;&nbsp;<font color="blue">private</font> <font color="#408080">SqlCeEngine</font> engine;<br /><br />&nbsp;&nbsp;<font color="blue">public</font> <font color="#408080">SqlCeEngineEx</font>()<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;engine = <font color="blue">new</font> <font color="#408080">SqlCeEngine</font>();<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">public</font> SqlCeEngineEx(<font color="blue">string</font> connectionString)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;engine = <font color="blue">new</font> <font color="#408080">SqlCeEngine</font>(connectionString);<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">public bool</font> DoesTableExist(<font color="blue">string</font> tablename)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;<font color="blue">bool</font> result = <font color="blue">false</font>;<br /><br />&nbsp;&nbsp;&nbsp;<font color="blue">using</font> (<font color="#408080">SqlCeConnection</font> conn = <font color="blue">new</font> <font color="#408080">SqlCeConnection</font>(LocalConnectionString)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;conn.Open();<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">using</font> (<font color="#408080">SqlCeCommand</font> cmd = conn.CreateCommand()) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd.CommandText =<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="red">@"SELECT COUNT(TABLE_NAME) <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM INFORMATION_SCHEMA.TABLES <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE TABLE_NAME=@Name"</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd.Parameters.AddWithValue(<font color="red">"@Name"</font>, tablename);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result = <font color="#408080">Convert</font>.ToBoolean(cmd.ExecuteScalar());<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;<font color="blue">return</font> result;<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">private string</font>[] PopulateStringList(<font color="#408080">SqlCeCommand</font> cmd)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;<font color="#408080">List</font><<font color="blue">string</font>> list = <font color="blue">new</font> <font color="#408080">List</font><<font color="blue">string</font>>();<br /><br />&nbsp;&nbsp;&nbsp;<font color="blue">using</font> (<font color="#408080">SqlCeDataReader</font> reader = cmd.ExecuteReader()) {<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">while</font> (reader.Read()) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.Add(reader.GetString(0));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;<font color="blue">return</font> list.ToArray();<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">public string</font>[] GetTables()<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;<font color="blue">string</font>[] tables;<br /><br />&nbsp;&nbsp;&nbsp;<font color="blue">using</font> (<font color="#408080">SqlCeConnection</font> conn = <font color="blue">new</font> <font color="#408080">SqlCeConnection</font>(LocalConnectionString)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;conn.Open();<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">using</font> (<font color="#408080">SqlCeCommand</font> cmd = conn.CreateCommand()) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd.CommandText = <font color="red">"SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES"</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tables = PopulateStringList(cmd);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;<font color="blue">return</font> tables;<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">public string</font>[] GetTableConstraints()<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;<font color="blue">string</font>[] constraints;<br /><br />&nbsp;&nbsp;&nbsp;<font color="blue">using</font> (<font color="#408080">SqlCeConnection</font> conn = <font color="blue">new</font> <font color="blue">SqlCeConnection</font>(LocalConnectionString)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;conn.Open();<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">using</font> (<font color="#408080">SqlCeCommand</font> cmd = conn.CreateCommand()) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd.CommandText = <font color="red">"SELECT CONSTRAINT_NAME FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS"</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;constraints = PopulateStringList(cmd);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;<font color="blue">return</font> constraints;<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">public string</font>[] GetTableConstraints(<font color="blue">string</font> tablename)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;<font color="blue">string</font>[] constraints;<br /><br />&nbsp;&nbsp;&nbsp;<font color="blue">using</font> (<font color="#408080">SqlCeConnection</font> conn = <font color="blue">new</font> <font color="#408080">SqlCeConnection</font>(LocalConnectionString)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;conn.Open();<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">using</font> (<font color="#408080">SqlCeCommand</font> cmd = conn.CreateCommand()) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd.CommandText =<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="red">@"SELECT CONSTRAINT_NAME <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE TABLE_NAME=@Name"</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd.Parameters.AddWithValue(<font color="red">"@Name"</font>, tablename);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;constraints = PopulateStringList(cmd);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;<font color="blue">return</font> constraints;<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">public string</font> LocalConnectionString<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;<font color="blue">get</font> { <font color="blue">return</font> engine.LocalConnectionString; }<br />&nbsp;&nbsp;&nbsp;<font color="blue">set</font> { engine.LocalConnectionString = <font color="blue">value</font>; }<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">public void</font> Compact()<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;engine.Compact(<font color="blue">null</font>);<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">public void</font> Compact(<font color="blue">string</font> connectionString)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;engine.Compact(connectionString);<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">public void</font> CreateDatabase()<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;engine.CreateDatabase();<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">public void</font> Repair(<font color="blue">string</font> connectionString, <font color="#408080">RepairOption</font> options)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;engine.Repair(connectionString, options);<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">public void</font> Shrink()<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;engine.Shrink();<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">public bool</font> Verify()<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;<font color="blue">return</font> engine.Verify();<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">public void</font> Dispose()<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;engine.Dispose();<br />&nbsp;&nbsp;&nbsp;engine = <font color="blue">null</font>;<br />&nbsp;&nbsp;}<br />}<br /></font>