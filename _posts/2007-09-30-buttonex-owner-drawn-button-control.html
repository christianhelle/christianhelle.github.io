---
layout: post
title: ButtonEx - Owner Drawn Button Control
date: '2007-09-30T15:08:00.002+02:00'
author: Christian Resma Helle
tags:
- Controls
- ".NET Compact Framework"
modified_time: '2008-10-30T15:41:33.247+01:00'
blogger_id: tag:blogger.com,1999:blog-4995334164049002857.post-2320776853180879041
blogger_orig_url: https://christian-helle.blogspot.com/2007/09/buttonex-owner-drawn-button-control.html
---

Wow 2 posts in 1 day. I must have a lot of spare time today! Actually I'm down with a cold and I just feel sorry for myself when I stay in bed.<br /><br />In this article I'd like to share another piece of code that I use quite often. Its a simple owner drawn button control that can have a nice 3D shadow. Drawing the 3D shadow effect was by complete accident though. I was trying to just draw a simple control that acts like a button. When I was drawing the borders the first time I drawn the rectangle a pixel bigger hence the control had a 1 pixel line of just black on the right and bottom side. Anyway, my graphic artist loved it and decided that we keep it.<br /><br />The control has the following properties added:<br />&nbsp;&nbsp;1) PushedColor (Color) - The color the control will be filled with once the MouseDown is fired<br />&nbsp;&nbsp;2) DrawShadow (Boolean) - A flag whether to draw the 3D border<br /><br />The default settings of the control is best on a form with a blue-ish background.<br /><br />And here's the code:<br /><font face="courier"><br /><font color="blue">public class</font> <font color="#408080">ButtonEx</font> : <font color="#408080">Control</font><br />{<br />&nbsp;&nbsp;<font color="blue">private</font> <font color="#408080">Bitmap</font> off_screen;<br />&nbsp;&nbsp;<font color="blue">private</font> <font color="#408080">SolidBrush</font> back_brush;<br />&nbsp;&nbsp;<font color="blue">private</font> <font color="#408080">SolidBrush</font> selected_brush;<br />&nbsp;&nbsp;<font color="blue">private</font> <font color="#408080">SolidBrush</font> text_brush;<br />&nbsp;&nbsp;<font color="blue">private</font> <font color="#408080">Pen</font> border_pen;<br />&nbsp;&nbsp;<font color="blue">private bool</font> pushed;<br />&nbsp;&nbsp;<font color="blue">private bool</font> shadow;<br /><br />&nbsp;&nbsp;<font color="blue">public</font> ButtonEx()<br />&nbsp;&nbsp;{   <br />&nbsp;&nbsp;&nbsp;&nbsp;BackColor = <font color="#408080">Color</font>.FromArgb(2, 32, 154);<br />&nbsp;&nbsp;&nbsp;&nbsp;ForeColor = <font color="#408080">Color</font>.White;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;back_brush = <font color="blue">new</font> <font color="#408080">SolidBrush</font>(<font color="#408080">Color</font>.FromArgb(48, 88, 198));<br />&nbsp;&nbsp;&nbsp;&nbsp;selected_brush = <font color="blue">new</font> <font color="#408080">SolidBrush</font>(<font color="#408080">Color</font>.FromArgb(15, 51, 190));<br />&nbsp;&nbsp;&nbsp;&nbsp;border_pen = <font color="blue">new</font> <font color="#408080">Pen</font>(<font color="#408080">Color</font>.White);<br />&nbsp;&nbsp;&nbsp;&nbsp;text_brush = <font color="blue">new</font> <font color="#408080">SolidBrush</font>(<font color="#408080">Color</font>.White);<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">public override</font> <font color="#408080">Color</font> BackColor<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">get</font> { <font color="blue">return base</font>.BackColor; }<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">set</font><br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">base</font>.BackColor = <font color="blue">value</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;back_brush = <font color="blue">new</font> <font color="#408080">SolidBrush</font>(<font color="blue">value</font>);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">public override</font> <font color="#408080">Color</font> ForeColor<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">get</font> { <font color="blue">return base</font>.ForeColor; }<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">set</font><br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">base</font>.ForeColor = <font color="blue">value</font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;border_pen = <font color="blue">new</font> <font color="#408080">Pen</font>(<font color="blue">value</font>);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text_brush = <font color="blue">new</font> <font color="#408080">SolidBrush</font>(<font color="blue">value</font>);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">public</font> <font color="#408080">Color</font> PushedColor<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">get</font> { <font color="blue">return</font> selected_brush.Color; }<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">set</font> { selected_brush = <font color="blue">new</font> <font color="#408080">SolidBrush</font>(<font color="blue">value</font>); }<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">public bool</font> DrawShadow<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">get</font> { return shadow; }<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">set</font> { shadow = <font color="blue">value</font>; }<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">protected override void</font> OnPaint(<font color="#408080">PaintEventArgs</font> e)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if</font> (off_screen == <font color="blue">null</font>) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off_screen = <font color="blue">new</font> <font color="#408080">Bitmap</font>(<font color="#408080">ClientSize</font>.Width, <font color="#408080">ClientSize</font>.Height);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">using</font> (<font color="#408080">Graphics</font> gxOff = <font color="#408080">Graphics</font>.FromImage(off_screen)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gxOff.DrawRectangle(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;border_pen,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#408080">ClientSize</font>.Width - (shadow ? 0 : 1),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#408080">ClientSize</font>.Height - (shadow ? 0 : 1));<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#408080">Rectangle</font> rect = <font color="blue">new</font> <font color="#408080">Rectangle</font>(1, 1, <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#408080">ClientRectangle</font>.Width - 2, <font color="#408080">ClientRectangle</font>.Height - 2);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gxOff.FillRectangle(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pushed ? back_brush : selected_brush, rect);<br />    <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if</font> (!<font color="blue">string</font>.IsNullOrEmpty(Text)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#408080">SizeF</font> size = gxOff.MeasureString(Text, Font);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gxOff.DrawString(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Text,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Font,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text_brush,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<font color="#408080">ClientSize</font>.Width - size.Width) / 2,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<font color="#408080">ClientSize</font>.Height - size.Height) / 2);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;e.Graphics.DrawImage(off_screen, 0, 0);<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">protected override void</font> OnPaintBackground(<font color="#408080">PaintEventArgs</font> e) { }<br /><br />&nbsp;&nbsp;<font color="blue">protected override void</font> OnMouseDown(<font color="#408080">MouseEventArgs</font> e)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">base</font>.OnMouseDown(e);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;pushed = true;<br />&nbsp;&nbsp;&nbsp;&nbsp;Invalidate();<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">protected override void</font> OnMouseUp(<font color="#408080">MouseEventArgs</font> e)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">base</font>.OnMouseUp(e);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;pushed = false;<br />&nbsp;&nbsp;&nbsp;&nbsp;Invalidate();<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<font color="blue">protected override void</font> OnTextChanged(<font color="#408080">EventArgs</font> e)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">base</font>.OnTextChanged(e);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;Invalidate();<br />&nbsp;&nbsp;}<br />}<br /></font>