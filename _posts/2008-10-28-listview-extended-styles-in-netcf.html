---
layout: post
title: ListView Extended Styles  in .NETCF
date: '2008-10-28T10:53:00.062+01:00'
author: Christian Resma Helle
tags:
- Controls
- ListView
- Windows Mobile
- ".NET Compact Framework"
modified_time: '2009-10-08T16:25:33.886+02:00'
blogger_id: tag:blogger.com,1999:blog-4995334164049002857.post-3665746400716942844
blogger_orig_url: https://christian-helle.blogspot.com/2008/10/listview-extended-styles-in-netcf.html
---

In this article I would like to demonstrate how to extend the ListView control in the .NET Compact Framework. We will focus on enabling some of the ListView Extended Styles. If we take a look at the Windows Mobile 5.0 Pocket PC SDK we will see that there are certain features of ListView that aren't provided by the .NET Compact Framework.<br /><br />An example of the ListView extended styles is displaying gridlines around items and subitems, double buffering, and drawing a gradient background. These extended styles can be enabled in native code by using the ListView_SetExtendedListViewStyle macro or by sending LVM_SETEXTENDEDLISTVIEWSTYLE messages to the ListView.<br /><br /><b>Send Message</b><br /><br />We will be using a lot of P/Invoking so let's start with creating an internal static class called NativeMethods. We need a P/Invoke declaration for SendMessage(HWND, UINT, UINT, UINT).<br /><span style="font-family:courier;"><br /><span style="color:blue;">internal static class</span> <span style="color: rgb(64, 128, 128);">NativeMethods</span><br />{<br />&nbsp;&nbsp;[<span style="color: rgb(64, 128, 128);">DllImport</span>(<span style="color:red;">"coredll.dll"</span>)]<br />&nbsp;&nbsp;<span style="color:blue;">public static extern uint</span> SendMessage(<span style="color: rgb(64, 128, 128);">IntPtr</span> hwnd, <span style="color:blue;">uint</span> msg, <span style="color:blue;">uint</span> wparam, <span style="color:blue;">uint</span> lparam);<br />}<br /></span><br /><b>Enabling and Disabling Extended Styles</b><br /><br />Now that we have our SendMessage P/Invoke declaration in place, we can begin extending the ListView control. Let's start off with creating a class called ListViewEx that inherits from ListView. We need to look into the native header files of the Pocket PC SDK to get the ListView Messages. For now we will only need LVM_[GET/SET]EXTENDEDLISTVIEWSTYLE message which will be the main focus of all the examples. I will declare my class as a partial class and create all the pieces one by one for each example. Let's create a private method called SetStyle(), this method will enable/disable extended styles for the ListView<br /><span style="font-family:courier;"><br /><span style="color:blue;">public partial class</span> <span style="color: rgb(64, 128, 128);">ListViewEx</span> : <span style="color: rgb(64, 128, 128);">ListView</span><br />{<br />&nbsp;&nbsp;<span style="color:blue;">private const uint</span> LVM_FIRST = 0x1000;<br />&nbsp;&nbsp;<span style="color:blue;">private const uint</span> LVM_SETEXTENDEDLISTVIEWSTYLE = LVM_FIRST + 54;<br />&nbsp;&nbsp;<span style="color:blue;">private const uint</span> LVM_GETEXTENDEDLISTVIEWSTYLE = LVM_FIRST + 55;<br /><br />&nbsp;&nbsp;<span style="color:blue;">private void</span> SetStyle(<span style="color:blue;">uint</span> style, <span style="color:blue;">bool</span> enable)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">uint</span> currentStyle = <span style="color: rgb(64, 128, 128);">NativeMethods</span>.SendMessage(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Handle,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LVM_GETEXTENDEDLISTVIEWSTYLE,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span> (enable)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(64, 128, 128);">NativeMethods</span>.SendMessage(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Handle,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LVM_SETEXTENDEDLISTVIEWSTYLE,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;currentStyle | style);<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(64, 128, 128);">NativeMethods</span>.SendMessage(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Handle,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LVM_SETEXTENDEDLISTVIEWSTYLE,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;currentStyle &amp; ~style);<br />&nbsp;&nbsp;}<br />}<br /></span><br /><b>Grid Lines</b><br /><br />For my first example, let's enable GridLines in the ListView control. We can do this by using LVS_EX_GRIDLINES. This displays gridlines around items and sub-items and is available only in conjunction with the Details mode.<br /><span style="font-family:courier;"><br /><span style="color:blue;">public partial class</span> <span style="color: rgb(64, 128, 128);">ListViewEx</span> : <span style="color: rgb(64, 128, 128);">ListView</span><br />{<br />&nbsp;&nbsp;<span style="color:blue;">private const uint</span> LVS_EX_GRIDLINES = 0x00000001;<br /><br />&nbsp;&nbsp;<span style="color:blue;">private bool</span> gridLines = <span style="color:blue;">false</span>;<br />&nbsp;&nbsp;<span style="color:blue;">public bool</span> GridLines<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">get</span> { <span style="color:blue;">return</span> gridLines; }<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">set</span><br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gridLines = <span style="color:blue;">value</span>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetStyle(LVS_EX_GRIDLINES, gridLines);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;}<br />}<br /></span><br />What the code above did was add the LVS_EX_GRIDLINES style to the existing extended styles by using the SetStyle() helper method we first created.<br /><br />An interesting discovery to this is that the Design Time attributes of the Compact Framework ListView control includes the GridLines property. Now that we created the property in the code, when we open the Visual Studio Properties Window for our ListViewEx we will notice that GridLines property we created falls immediately under the "Appearance" category and even includes a description :)<br /><br /><b>Double Buffering</b><br /><br />Do you notice that when you populate a ListView control with a lot of items, the drawing flickers a lot when you scroll up and down the list? Although it is not in the Pocket PC documentation for Windows Mobile 5.0, the ListView actually has an extended style called LVS_EX_DOUBLEBUFFER. Enabling the LVS_EX_DOUBLEBUFFER solves the flickering issue and gives the user a more smooth scrolling experience.<br /><span style="font-family:courier;"><br /><span style="color:blue;">public partial class</span> <span style="color: rgb(64, 128, 128);">ListViewEx</span> : <span style="color: rgb(64, 128, 128);">ListView</span><br />{<br />&nbsp;&nbsp;<span style="color:blue;">private const uint</span> LVS_EX_DOUBLEBUFFER = 0x00010000;<br /><br />&nbsp;&nbsp;<span style="color:blue;">private bool</span> doubleBuffering = <span style="color:blue;">false</span>;<br />&nbsp;&nbsp;<span style="color:blue;">public bool</span> DoubleBuffering<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">get</span> { <span style="color:blue;">return</span> doubleBuffering; }<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">set</span><br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doubleBuffering = <span style="color:blue;">value</span>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetStyle(LVS_EX_DOUBLEBUFFER, doubleBuffering);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;}<br />}<br /></span><br /><b>Gradient Background</b><br /><br />Another cool extended style is the LVS_EX_GRADIENT. This extended style draws a gradient background similar to the one found in Pocket Outlook. It uses the system colors and fades from right to left. But what is really cool about this is that this is done by the OS. All we had to do was enable the style.<br /><span style="font-family:courier;"><br /><span style="color:blue;">public partial class</span> <span style="color: rgb(64, 128, 128);">ListViewEx</span> : <span style="color: rgb(64, 128, 128);">ListView</span><br />{<br />&nbsp;&nbsp;<span style="color:blue;">private const uint</span> LVS_EX_GRADIENT = 0x20000000;<br /><br />&nbsp;&nbsp;<span style="color:blue;">private bool</span> gradient = <span style="color:blue;">false</span>;<br />&nbsp;&nbsp;<span style="color:blue;">public bool</span> Gradient<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">get</span> { <span style="color:blue;">return</span> gradient; }<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">set</span><br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gradient = <span style="color:blue;">value</span>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetStyle(LVS_EX_GRADIENT, gradient);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;}<br />}<br /></span><br />If you want to look more into extended styles then I suggest you check out the Pocket PC Platform SDK documentation. There a few other extended styles that I did not discuss that might be useful for you. You can get the definitions in a file called commctrl.h in your Windows Mobile SDK "INCLUDE" directory.